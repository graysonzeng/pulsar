<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>消息保留和过期 · Apache Pulsar</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Pulsar brokers 负责处理通过 Pulsar 的消息，包括消息的[存储持久化](/docs/zh-CN/next/concepts-architecture-overview#persistent-storage)。 默认情况下，对于每个主题，broker 会至少保留一个 backlog 消息。 backlog 是特定订阅的未确认的消息的集合。 每个主题可以有多个订阅者，所以每个主题可以有多个 backlog。"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="消息保留和过期 · Apache Pulsar"/><meta property="og:type" content="website"/><meta property="og:url" content="https://pulsar.apache.org/"/><meta property="og:description" content="Pulsar brokers 负责处理通过 Pulsar 的消息，包括消息的[存储持久化](/docs/zh-CN/next/concepts-architecture-overview#persistent-storage)。 默认情况下，对于每个主题，broker 会至少保留一个 backlog 消息。 backlog 是特定订阅的未确认的消息的集合。 每个主题可以有多个订阅者，所以每个主题可以有多个 backlog。"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://pulsar.apache.org/img/pulsar.svg"/><link rel="shortcut icon" href="/img/pulsar.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://pulsar.apache.org/blog/atom.xml" title="Apache Pulsar Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://pulsar.apache.org/blog/feed.xml" title="Apache Pulsar Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-102219959-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/custom.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/pulsar.svg" alt="Apache Pulsar"/></a><a href="/zh-CN/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/zh-CN/next/standalone" target="_self">文档</a></li><li class=""><a href="/zh-CN/download" target="_self">下载</a></li><li class="siteNavGroupActive"><a href="/docs/zh-CN/next/client-libraries" target="_self">客户端</a></li><li class=""><a href="#restapis" target="_self">REST API</a></li><li class=""><a href="#cli" target="_self">命令行</a></li><li class=""><a href="/blog/" target="_self">博客</a></li><li class=""><a href="#community" target="_self">社区</a></li><li class=""><a href="#apache" target="_self">Apache</a></li><li class=""><a href="https://pulsar-next.staged.apache.org/" target="_self">New Website(Beta)</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/next/cookbooks-retention-expiry">English</a></li><li><a href="/docs/ja/next/cookbooks-retention-expiry">日本語</a></li><li><a href="/docs/fr/next/cookbooks-retention-expiry">Français</a></li><li><a href="/docs/ko/next/cookbooks-retention-expiry">한국어</a></li><li><a href="/docs/zh-TW/next/cookbooks-retention-expiry">繁體中文</a></li><li><a href="https://crowdin.com/project/apache-pulsar" target="_blank" rel="noreferrer noopener">参与翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>参考手册</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Get Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/standalone">本地运行 Pulsar</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/standalone-docker">在 Docker 中运行 Pulsar</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/kubernetes-helm">在 Kubernetes 中运行 Pulsar</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">概念和架构</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-messaging">消息</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-architecture-overview">架构</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-clients">客户端</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-replication">跨机房复制</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-multi-tenancy">多租户</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-authentication">认证和授权</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-topic-compaction">消息压缩</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-proxy-sni-routing">Pulsar Proxy 支持 SNI 路由</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-multiple-advertised-listeners">配置 Advertised 监听器</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar Schema</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/schema-get-started">开始</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/schema-understand">理解 schema</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/schema-evolution-compatibility">Schema 演化和兼容</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/schema-manage">管理 Schema</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar Functions</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-runtime">设置：配置 Pulsar Functions 运行时</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-worker">设置：Pulsar Functions Worker</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-develop">操作：开发</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-package">如何打包</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-debug">操作：调试</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-deploy">操作：部署</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-cli">参考：命令</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/window-functions-context">窗口函数：上下文</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar IO</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-quickstart">开始</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-use">使用</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-debug">调试</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-connectors">内置 connector</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-cdc">CDC connector</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-develop">开发</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-cli">CLI</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar SQL</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/sql-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/sql-getting-started">查询数据</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/sql-deployment-configurations">配置和部署</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/sql-rest-api">REST API</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">层级存储</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/tiered-storage-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/tiered-storage-aws">亚马逊 AWS S3 offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/tiered-storage-gcs">GCS offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/tiered-storage-filesystem">Filesystem offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/tiered-storage-azure">Azure BlobStore offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/tiered-storage-aliyun">阿里云 OSS offloader</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">事务</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/txn-why">为什么需要事务？</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/txn-what">什么是事务？</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/txn-how">事务运行原理</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/txn-use">如何使用事务？</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/txn-monitor">如何监控事务？</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Kubernetes (Helm)</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/helm-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/helm-prepare">准备</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/helm-install">安装</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/helm-deploy">部署</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/helm-upgrade">升级</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/helm-tools">所需工具</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">部署</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-aws">Amazon Web Services (Aws)</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-kubernetes">Kubernetes</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-bare-metal">裸机</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-bare-metal-multi-cluster">裸机多集群部署</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-docker">Docker</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-monitoring">Monitor</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">系统管理</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-zk-bk">ZooKeeper 和 BookKeeper</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-geo">跨地域复制</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-pulsar-manager">Pulsar Manager</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-stats">Pulsar 统计数据</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-load-balance">负载均衡</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-proxy">Pulsar 代理</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-upgrade">升级</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-isolation">Pulsar 隔离</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">安全</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-policy-and-supported-versions">安全政策和支持的版本</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-tls-transport">使用TLS进行传输加密</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-tls-authentication">使用TLS进行认证</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-tls-keystore">使用 TLS 配置KeyStore</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-jwt">使用 JWT 认证</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-athenz">使用 Athenz 验证</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-kerberos">使用 Kerberos 进行身份验证</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-oauth2">使用 OAuth 2.0 访问令牌进行身份验证</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-authorization">授权和ACL</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-encryption">端到端加密</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-extending">扩展</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-bouncy-castle">Bouncy Castle Providers</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">性能</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/performance-pulsar-perf">Pulsar Perf 性能测试</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">客户端库</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-java">Java</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-go">Go</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-python">Python</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-cpp">C++</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-node">Node.js
</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-websocket">WebSocket</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-dotnet">C#</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-rest">REST</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Admin API</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-clusters">集群</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-tenants">租户</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-brokers">Brokers</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-namespaces">命名空间</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-permissions">权限管理</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-topics">Topic</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-functions">Functions</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-packages">Package</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">适配器</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/adaptors-kafka">Kafka 客户端封装</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/adaptors-spark">Apache Spark</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/adaptors-storm">Apache Storm</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">参考手册</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-compaction">Topic compaction</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-deduplication">消息去重</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-non-persistent">非持久化消息</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/zh-CN/next/cookbooks-retention-expiry">消息保留和过期</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-encryption">加密</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-message-queue">消息队列</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-bookkeepermetadata">BookKeeper Ledger 元数据</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">开发</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/develop-tools">模拟工具</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/develop-binary-protocol">二进制协议</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/develop-load-manager">模块化负载管理器</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/develop-plugin">Plugin</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">参考</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/reference-terminology">术语</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/reference-cli-tools">Pulsar 命令行工具</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/reference-configuration">Pulsar configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/reference-metrics">Pulsar Metrics</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/apache-pulsar/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">消息保留和过期</h1></header><article><div><span><p>Pulsar brokers 负责处理通过 Pulsar 的消息，包括消息的<a href="/docs/zh-CN/next/concepts-architecture-overview#persistent-storage">存储持久化</a>。 默认情况下，对于每个主题，broker 会至少保留一个 backlog 消息。 backlog 是特定订阅的未确认的消息的集合。 每个主题可以有多个订阅者，所以每个主题可以有多个 backlog。</p>
<p>因此，在一个没有创建任何订阅的主题上不会保留任何消息(默认情况下)。</p>
<p>（注意，不再被存储的消息不需要立即删除，事实上可能仍然可以被访问，直到下一个 ledger 滚动创建。 因为客户端无法预测 ledger 什么时候发生滚动，所以依赖滚动发生在合适的时间是不明智的。）</p>
<p>在 Pulsar 中，你有两种方式在命名空间的级别去修改这种行为：</p>
<ul>
<li>你可以通过设置<a href="#retention-policies">消息保留策略</a>持久化存储不在 backlog 内的消息(因为他们已经在每个现有的订阅上被确认，或者并没有被订阅)。</li>
<li>可以通过设置<a href="#time-to-live-ttl"> time to live</a>(TTL)，设置消息在指定的时间内不被确认的话，自动确认。</li>
</ul>
<p>你可以通过 Pulsar <a href="/docs/zh-CN/next/admin-api-overview"> admin 接口</a> 在命名空间(租户、集群或<a href="/docs/zh-CN/next/concepts-architecture-overview#global-cluster"><code>整个</code></a>集群) 级别管理消息保留策略和TTL。</p>
<blockquote>
<h4><a class="anchor" aria-hidden="true" id="消息保留和-ttl-有以下两点不同"></a><a href="#消息保留和-ttl-有以下两点不同" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消息保留和 TTL 有以下两点不同</h4>
<ul>
<li>消息保留: 保留消息(包括已确认的) 数据至少X小时</li>
<li>TTL：一段时间后丢弃数据（自动确认）</li>
</ul>
<p>大多数应用程序最多只想使用其中的一个。</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="消息保留策略"></a><a href="#消息保留策略" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消息保留策略</h2>
<p>默认情况下，当消息到达 broker 时，会一直保留这条消息直到消费者确认已消费到这条消息，此时它才被删除。 你可以修改命名空间中所有主题的<em>消息保留策略</em>，来保留所有订阅中已经确认的消息。 消息保留策略支持两种类型：<em>根据消息大小保留</em>或者<em>根据时间保留</em>。</p>
<p>The diagram below illustrates the concept of message retention. <img src="/docs/assets/retention.svg" alt=""></p>
<p>当使用 Reader 接口时，保留策略是有用的。 因为 Reader 接口不使用消息确认机制，消息将永远不会存在 backlog 中。 在只读的使用场景中，保留时间是必须配置的。</p>
<p>When you set a retention policy on topics in a namespace, you must set <strong>both</strong> a <em>size limit</em> (via <code>defaultRetentionSizeInMB</code>) and a <em>time limit</em> (via <code>defaultRetentionTimeInMinutes</code>) . 您可以参考以下表格来设置 <code>pulsar-admin</code> 和 Java 中的保留策略。</p>
<table>
<thead>
<tr><th>时间限制</th><th>大小限制：</th><th>消息保留策略</th></tr>
</thead>
<tbody>
<tr><td>-1</td><td>-1</td><td>无限保留</td></tr>
<tr><td>-1</td><td>&gt;0</td><td>基于存储大小限制</td></tr>
<tr><td>&gt;0</td><td>-1</td><td>基于存储时间限制</td></tr>
<tr><td>0</td><td>0</td><td>不开启消息保留机制(默认值)</td></tr>
<tr><td>0</td><td>&gt;0</td><td>无效</td></tr>
<tr><td>&gt;0</td><td>0</td><td>无效</td></tr>
<tr><td>&gt;0</td><td>&gt;0</td><td>当消息保留时间或大小达到限制时，不会保留已确认的消息或没有活跃订阅者的消息。</td></tr>
</tbody>
</table>
<p>消息保留策略配置会对没有订阅的主题的所有消息生效，或者对有订阅的主题并已被所有消费者确认的消息生效。 保留策略设置不影响订阅主题的未确认消息。 未确认的信息受积压配额控制。</p>
<p>当超过保留限额时，最老的消息会被标记删除，直到保留的消息在指定的限制范围之内。</p>
<h3><a class="anchor" aria-hidden="true" id="默认值"></a><a href="#默认值" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>默认值</h3>
<p>你可以通过以下两个参数来配置实例级别的消息保留策略:： <code>defaultRetentionTimeInminutes</code> and <code>defaultReintentionSizeInMB</code> 默认情况下，这两个参数都设置为 <code>0</code>。</p>
<p>如果需要了解两个参数的更多信息，请参阅 <a href="/docs/zh-CN/next/reference-configuration#broker"><code>broker.conf</code></a> 配置文件。</p>
<h3><a class="anchor" aria-hidden="true" id="设置保留策略"></a><a href="#设置保留策略" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设置保留策略</h3>
<p>你可以通过在 <code>pulsar-admin</code>、REST API 和 Java 中自定命名空间、大小限制和时间限制来设置命名空间的保留策略。</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-2970-tab-2971" class="nav-link active" data-group="group_2970" data-tab="tab-group-2970-content-2971">pulsar-admin</div><div id="tab-group-2970-tab-2972" class="nav-link" data-group="group_2970" data-tab="tab-group-2970-content-2972">REST API</div><div id="tab-group-2970-tab-2973" class="nav-link" data-group="group_2970" data-tab="tab-group-2970-content-2973">Java</div></div><div class="tab-content"><div id="tab-group-2970-content-2971" class="tab-pane active" data-group="group_2970" tabindex="-1"><div><span><p><a href="/docs/zh-CN/next/pulsar-admin#namespaces-set-retention"><code>set-retention</code></a>子命令并指定命名空间，使用<code>-s</code>/<code>--size</code>参数指定大小限制，使用<code>-t</code>/<code>--time</code>参数指定时间限制。</p>
<p>在下面的例子中， <code>my-tenant/my-ns</code> 命名空间中的每一个主题大小限制设置为 10 GB，时间限制设置为 3 小时。 - When the size of messages reaches 10 GB on a topic within 3 hours, the acknowledged messages will not be retained. - After 3 hours, even if the message size is less than 10 GB, the acknowledged messages will not be retained.</p>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> pulsar-admin namespaces <span class="hljs-built_in">set</span>-retention my-tenant/my-ns \</span><br />  --size 10G \<br />  --time 3h<br /></code></pre>
<p>In the following example, the time is not limited and the size limit is set to 1 TB. The size limit determines the retention.</p>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> pulsar-admin namespaces <span class="hljs-built_in">set</span>-retention my-tenant/my-ns \</span><br />  --size 1T \<br />  --time -1<br /></code></pre>
<p>In the following example, the size is not limited and the time limit is set to 3 hours. The time limit determines the retention.</p>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> pulsar-admin namespaces <span class="hljs-built_in">set</span>-retention my-tenant/my-ns \</span><br />  --size -1 \<br />  --time 3h<br /></code></pre>
<p>要实现无限留存，将两个值都设置为 <code>-1</code>。</p>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> pulsar-admin namespaces <span class="hljs-built_in">set</span>-retention my-tenant/my-ns \</span><br />  --size -1 \<br />  --time -1<br /></code></pre>
<p>要禁用消息保留恶略配置，将值设置为 <code>0</code>。</p>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> pulsar-admin namespaces <span class="hljs-built_in">set</span>-retention my-tenant/my-ns \</span><br />  --size 0 \<br />  --time 0<br /></code></pre>
</span></div></div><div id="tab-group-2970-content-2972" class="tab-pane" data-group="group_2970" tabindex="-1"><div><span><blockquote>
<p><strong>注意</strong>  <br>
要禁用保留策略 您需要同时设置大小和时间限制为 <code>0</code>。 只设置大小限制或者只设置时间限制为 <code>0</code> 则是是无效的配置。</p>
</blockquote>
</span></div></div><div id="tab-group-2970-content-2973" class="tab-pane" data-group="group_2970" tabindex="-1"><div><span><pre><code class="hljs css language-java"><span class="hljs-keyword">int</span> retentionTime = <span class="hljs-number">10</span>; <span class="hljs-comment">// 10 minutes</span><br /><span class="hljs-keyword">int</span> retentionSize = <span class="hljs-number">500</span>; <span class="hljs-comment">// 500 megabytes</span><br />RetentionPolicies policies = <span class="hljs-keyword">new</span> RetentionPolicies(retentionTime, retentionSize);<br />admin.namespaces().setRetention(namespace, policies);<br /></code></pre>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="获取保留策略"></a><a href="#获取保留策略" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>获取保留策略</h3>
<p>可以通过指定命名空间来获取命名空间的保留策略。 输出的是一个包含两个键值对的JSON对象：<code>retentionTimeInMinutes</code> and <code>retentionSizeInMB</code>。</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-2974-tab-2975" class="nav-link active" data-group="group_2974" data-tab="tab-group-2974-content-2975">pulsar-admin</div><div id="tab-group-2974-tab-2976" class="nav-link" data-group="group_2974" data-tab="tab-group-2974-content-2976">REST API</div><div id="tab-group-2974-tab-2977" class="nav-link" data-group="group_2974" data-tab="tab-group-2974-content-2977">Java</div></div><div class="tab-content"><div id="tab-group-2974-content-2975" class="tab-pane active" data-group="group_2974" tabindex="-1"><div><span><p>使用 <a href="/docs/zh-CN/next/pulsar-admin#namespaces"><code>get-retention</code></a>子命令并指定命名空间。</p>
<h5><a class="anchor" aria-hidden="true" id="示例"></a><a href="#示例" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>示例</h5>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> pulsar-admin namespaces get-retention my-tenant/my-ns</span><br />{<br />  "retentionTimeInMinutes": 10,<br />  "retentionSizeInMB": 500<br />}<br /></code></pre>
</span></div></div><div id="tab-group-2974-content-2976" class="tab-pane" data-group="group_2974" tabindex="-1"><div><span><p><a href="https://pulsar.apache.org/admin-rest-api#operation/getRetention?version=2.9.1&amp;apiVersion=v2"><b>GET</b> <i>/admin/v2/namespaces/:tenant/:namespace/retention</i></a>
</p>
</span></div></div><div id="tab-group-2974-content-2977" class="tab-pane" data-group="group_2974" tabindex="-1"><div><span><pre><code class="hljs css language-java">admin.namespaces().getRetention(namespace);<br /></code></pre>
</span></div></div></div></div>
<h2><a class="anchor" aria-hidden="true" id="backlog-quotas"></a><a href="#backlog-quotas" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Backlog quotas</h2>
<p><em>Backlogs</em>是由bookies存储的主题的未确认消息集。 Pulsar把所有未确认的消息存储在Backlog中，直到它们被处理和确认为止。</p>
<p>You can control the allowable size and/or time of backlogs, at the namespace level, using <em>backlog quotas</em>. Pulsar uses a quota to enforce a hard limit on the logical size of the backlogs in a topic. Backlog quota triggers an alert policy (for example, producer exception) once the quota limit is reached.</p>
<p>The diagram below illustrates the concept of backlog quota. <img src="/docs/assets/backlog-quota.svg" alt=""></p>
<p>Setting a backlog quota involves setting:</p>
<ul>
<li>an allowable <em>size and/or time threshold</em> for each topic in the namespace</li>
<li><em>保留策略</em>，决定了如果超过阈值，<a href="/docs/zh-CN/next/reference-terminology#broker">broker</a> 将采取什么操作。</li>
</ul>
<p>可以使用以下保留策略：</p>
<table>
<thead>
<tr><th style="text-align:left">策略</th><th style="text-align:left">触发的操作</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>producer_request_hold</code></td><td style="text-align:left">Broker 会持有生产者投递的消息，但并不会把投递的消息进行持久化存储</td></tr>
<tr><td style="text-align:left"><code>producer_exception</code></td><td style="text-align:left">Broker 会与客户端断开连接并抛出异常</td></tr>
<tr><td style="text-align:left"><code>consumer_backlog_eviction</code></td><td style="text-align:left">Broker 将开始丢弃backlog的消息</td></tr>
</tbody>
</table>
<blockquote>
<h4><a class="anchor" aria-hidden="true" id="注意保留策略类型之间的区别"></a><a href="#注意保留策略类型之间的区别" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>注意保留策略类型之间的区别</h4>
<p>你可能已经注意到，Pulsar 中关于“保留策略”有两种定义，一种适用于已确认消息的持久存储，一种适用于 backlog。</p>
</blockquote>
<p>Backlog quotas 在命名空间级别处理。 它们可以通过以下方式管理:</p>
<h3><a class="anchor" aria-hidden="true" id="设定大小时间阈值和积压保留政策"></a><a href="#设定大小时间阈值和积压保留政策" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设定大小/时间阈值和积压保留政策</h3>
<p>您可以通过指定命名空间、大小限制和/或时间限制（以秒为单位）以及按名称指定的策略，为<a href="/docs/zh-CN/next/reference-terminology#namespace">命名空间</a>中的所有主题设置大小或时间阈值（可以同时设置大小和时间阈值或者只设置其中一个阈值）以及积压保留策略。</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-2978-tab-2979" class="nav-link active" data-group="group_2978" data-tab="tab-group-2978-content-2979">pulsar-admin</div><div id="tab-group-2978-tab-2980" class="nav-link" data-group="group_2978" data-tab="tab-group-2978-content-2980">REST API</div><div id="tab-group-2978-tab-2981" class="nav-link" data-group="group_2978" data-tab="tab-group-2978-content-2981">Java</div></div><div class="tab-content"><div id="tab-group-2978-content-2979" class="tab-pane active" data-group="group_2978" tabindex="-1"><div><span><p>Use the <a href="/docs/zh-CN/next/pulsar-admin#namespaces"><code>set-backlog-quota</code></a> subcommand and specify a namespace, a size limit using the <code>-l</code>/<code>--limit</code> , <code>-lt</code>/<code>--limitTime</code> flag to limit backlog, a retention policy using the <code>-p</code>/<code>--policy</code> flag and a policy type using <code>-t</code>/<code>--type</code> (default is destination_storage).</p>
<h5><a class="anchor" aria-hidden="true" id="示例"></a><a href="#示例" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>示例</h5>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> pulsar-admin namespaces <span class="hljs-built_in">set</span>-backlog-quota my-tenant/my-ns \</span><br />  --limit 2G \<br />  --policy producer_request_hold<br /></code></pre>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> pulsar-admin namespaces <span class="hljs-built_in">set</span>-backlog-quota my-tenant/my-ns/my-topic \</span><br />--limitTime 3600 \<br />--policy producer_request_hold \<br />--type message_age<br /></code></pre>
</span></div></div><div id="tab-group-2978-content-2980" class="tab-pane" data-group="group_2978" tabindex="-1"><div><span><p><a href="https://pulsar.apache.org/admin-rest-api#operation/setBacklogQuota?version=2.9.1&amp;apiVersion=v2"><b>POST</b> <i>/admin/v2/namespaces/:tenant/:namespace/backlogQuota</i></a>
</p>
</span></div></div><div id="tab-group-2978-content-2981" class="tab-pane" data-group="group_2978" tabindex="-1"><div><span><pre><code class="hljs css language-java"><span class="hljs-keyword">long</span> sizeLimit = <span class="hljs-number">2147483648L</span>;<br />BacklogQuota.RetentionPolicy policy = BacklogQuota.RetentionPolicy.producer_request_hold;<br />BacklogQuota quota = <span class="hljs-keyword">new</span> BacklogQuota(sizeLimit, policy);<br />admin.namespaces().setBacklogQuota(namespace, quota);<br /></code></pre>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="获取积压阈值和积压保留政策"></a><a href="#获取积压阈值和积压保留政策" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>获取积压阈值和积压保留政策</h3>
<p>可以查看已对命名空间应用的大小阈值和 backlog 保留策略。</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-2982-tab-2983" class="nav-link active" data-group="group_2982" data-tab="tab-group-2982-content-2983">pulsar-admin</div><div id="tab-group-2982-tab-2984" class="nav-link" data-group="group_2982" data-tab="tab-group-2982-content-2984">REST API</div><div id="tab-group-2982-tab-2985" class="nav-link" data-group="group_2982" data-tab="tab-group-2982-content-2985">Java</div></div><div class="tab-content"><div id="tab-group-2982-content-2983" class="tab-pane active" data-group="group_2982" tabindex="-1"><div><span><p>使用<a href="/docs/zh-CN/next/pulsar-admin#pulsar-admin-namespaces-get-backlog-quotas"> <code>get-backlog-quotas</code> </a>子命令并指定命名空间。 下面是一个示例：</p>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> pulsar-admin namespaces get-backlog-quotas my-tenant/my-ns</span><br />{<br />  "destination_storage": {<br />    "limit" : 2147483648,<br />    "policy" : "producer_request_hold"<br />  }<br />}<br /></code></pre>
</span></div></div><div id="tab-group-2982-content-2984" class="tab-pane" data-group="group_2982" tabindex="-1"><div><span><p><a href="https://pulsar.apache.org/admin-rest-api#operation/getBacklogQuotaMap?version=2.9.1&amp;apiVersion=v2"><b>GET</b> <i>/admin/v2/namespaces/:tenant/:namespace/backlogQuotaMap</i></a>
</p>
</span></div></div><div id="tab-group-2982-content-2985" class="tab-pane" data-group="group_2982" tabindex="-1"><div><span><pre><code class="hljs css language-java">Map&lt;BacklogQuota.BacklogQuotaType,BacklogQuota&gt; quotas =<br />  admin.namespaces().getBacklogQuotas(namespace);<br /></code></pre>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="移除-backlog-quota-策略"></a><a href="#移除-backlog-quota-策略" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>移除 backlog quota 策略</h3>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-2986-tab-2987" class="nav-link active" data-group="group_2986" data-tab="tab-group-2986-content-2987">pulsar-admin</div><div id="tab-group-2986-tab-2988" class="nav-link" data-group="group_2986" data-tab="tab-group-2986-content-2988">REST API</div><div id="tab-group-2986-tab-2989" class="nav-link" data-group="group_2986" data-tab="tab-group-2986-content-2989">Java</div></div><div class="tab-content"><div id="tab-group-2986-content-2987" class="tab-pane active" data-group="group_2986" tabindex="-1"><div><span><p>Use the <a href="/docs/zh-CN/next/pulsar-admin#pulsar-admin-namespaces-remove-backlog-quota"><code>remove-backlog-quota</code></a> subcommand and specify a namespace, use <code>t</code>/<code>--type</code> to specify backlog type to remove(default is destination_storage). 下面是一个示例：</p>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> pulsar-admin namespaces remove-backlog-quota my-tenant/my-ns</span><br /></code></pre>
</span></div></div><div id="tab-group-2986-content-2988" class="tab-pane" data-group="group_2986" tabindex="-1"><div><span><p><a href="https://pulsar.apache.org/admin-rest-api#operation/removeBacklogQuota?version=2.9.1&amp;apiVersion=v2"><b>DELETE</b> <i>/admin/v2/namespaces/:tenant/:namespace/backlogQuota</i></a>
</p>
</span></div></div><div id="tab-group-2986-content-2989" class="tab-pane" data-group="group_2986" tabindex="-1"><div><span><pre><code class="hljs css language-java">admin.namespaces().removeBacklogQuota(namespace);<br /></code></pre>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="清除积压消息"></a><a href="#清除积压消息" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>清除积压消息</h3>
<h4><a class="anchor" aria-hidden="true" id="pulsar-admin"></a><a href="#pulsar-admin" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pulsar-admin</h4>
<p>使用 <a href="/docs/zh-CN/next/pulsar-admin#pulsar-admin-namespaces-clear-backlog"><code>clear-backlog</code></a> 子命令。</p>
<h5><a class="anchor" aria-hidden="true" id="示例"></a><a href="#示例" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>示例</h5>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> pulsar-admin namespaces clear-backlog my-tenant/my-ns</span>
</code></pre>
<p>默认情况下，系统会提示您确认确实要清除命名空间的 backlog。您可以使用<code>-f</code>/<code>——force</code>参数覆盖提示。</p>
<h2><a class="anchor" aria-hidden="true" id="生存时间-ttl"></a><a href="#生存时间-ttl" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生存时间 (TTL)</h2>
<p>默认情况下，Pulsar 会永久存储所有未确认的消息。 在大量消息未得到确认的情况下，可能会导致大量磁盘空间的使用。 如果需要考虑磁盘空间，可以设置生存时间(TTL)，以确定未确认的消息将保留多长时间。</p>
<p>The TTL parameter is like a stopwatch attached to each message that defines the amount of time a message is allowed to stay in the unacknowledged state. When the TTL expires, Pulsar automatically moves the message to the acknowledged state (and thus makes it ready for deletion).</p>
<p>The diagram below illustrates the concept of TTL. <img src="/docs/assets/ttl.svg" alt=""></p>
<h3><a class="anchor" aria-hidden="true" id="设置命名空间的ttl"></a><a href="#设置命名空间的ttl" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设置命名空间的TTL</h3>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-2990-tab-2991" class="nav-link active" data-group="group_2990" data-tab="tab-group-2990-content-2991">pulsar-admin</div><div id="tab-group-2990-tab-2992" class="nav-link" data-group="group_2990" data-tab="tab-group-2990-content-2992">REST API</div><div id="tab-group-2990-tab-2993" class="nav-link" data-group="group_2990" data-tab="tab-group-2990-content-2993">Java</div></div><div class="tab-content"><div id="tab-group-2990-content-2991" class="tab-pane active" data-group="group_2990" tabindex="-1"><div><span><p>使用<a href="/docs/zh-CN/next/pulsar-admin#pulsar-admin-namespaces-set-message-ttl"> <code>set-message-ttl</code> </a>子命令并指定命名空间和TTL(以秒为单位，使用<code>-ttl</code>/<code>--messageTTL</code>参数指定)。</p>
<h5><a class="anchor" aria-hidden="true" id="示例"></a><a href="#示例" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>示例</h5>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> pulsar-admin namespaces <span class="hljs-built_in">set</span>-message-ttl my-tenant/my-ns \</span><br />  --messageTTL 120 # TTL of 2 minutes<br /></code></pre>
</span></div></div><div id="tab-group-2990-content-2992" class="tab-pane" data-group="group_2990" tabindex="-1"><div><span><p><a href="https://pulsar.apache.org/admin-rest-api#operation/setNamespaceMessageTTL?version=2.9.1&amp;apiVersion=v2"><b>POST</b> <i>/admin/v2/namespaces/:tenant/:namespace/messageTTL</i></a>
</p>
</span></div></div><div id="tab-group-2990-content-2993" class="tab-pane" data-group="group_2990" tabindex="-1"><div><span><pre><code class="hljs css language-java">admin.namespaces().setNamespaceMessageTTL(namespace, ttlInSeconds);<br /></code></pre>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="获取命名空间的-ttl-配置"></a><a href="#获取命名空间的-ttl-配置" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>获取命名空间的 TTL 配置</h3>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-2994-tab-2995" class="nav-link active" data-group="group_2994" data-tab="tab-group-2994-content-2995">pulsar-admin</div><div id="tab-group-2994-tab-2996" class="nav-link" data-group="group_2994" data-tab="tab-group-2994-content-2996">REST API</div><div id="tab-group-2994-tab-2997" class="nav-link" data-group="group_2994" data-tab="tab-group-2994-content-2997">Java</div></div><div class="tab-content"><div id="tab-group-2994-content-2995" class="tab-pane active" data-group="group_2994" tabindex="-1"><div><span><p>使用 <a href="/docs/zh-CN/next/pulsar-admin#pulsar-admin-namespaces-get-message-ttl"><code>get-message-ttl</code></a> 子命令并指定命名空间。</p>
<h5><a class="anchor" aria-hidden="true" id="示例"></a><a href="#示例" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>示例</h5>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> pulsar-admin namespaces get-message-ttl my-tenant/my-ns</span><br />60<br /></code></pre>
</span></div></div><div id="tab-group-2994-content-2996" class="tab-pane" data-group="group_2994" tabindex="-1"><div><span><p><a href="https://pulsar.apache.org/admin-rest-api#operation/getNamespaceMessageTTL?version=2.9.1&amp;apiVersion=v2"><b>GET</b> <i>/admin/v2/namespaces/:tenant/:namespace/messageTTL</i></a>
</p>
</span></div></div><div id="tab-group-2994-content-2997" class="tab-pane" data-group="group_2994" tabindex="-1"><div><span><pre><code class="hljs css language-java">admin.namespaces().getNamespaceMessageTTL(namespace)<br /></code></pre>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="删除命名空间的ttl配置"></a><a href="#删除命名空间的ttl配置" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>删除命名空间的TTL配置</h3>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-2998-tab-2999" class="nav-link active" data-group="group_2998" data-tab="tab-group-2998-content-2999">pulsar-admin</div><div id="tab-group-2998-tab-3000" class="nav-link" data-group="group_2998" data-tab="tab-group-2998-content-3000">REST API</div><div id="tab-group-2998-tab-3001" class="nav-link" data-group="group_2998" data-tab="tab-group-2998-content-3001">Java</div></div><div class="tab-content"><div id="tab-group-2998-content-2999" class="tab-pane active" data-group="group_2998" tabindex="-1"><div><span><p>使用 <a href="/docs/zh-CN/next/pulsar-admin#pulsar-admin-namespaces-remove-message-ttl"><code>get-message-ttl</code></a> 子命令并指定命名空间。</p>
<h5><a class="anchor" aria-hidden="true" id="示例"></a><a href="#示例" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>示例</h5>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> pulsar-admin namespaces remove-message-ttl my-tenant/my-ns</span><br /></code></pre>
</span></div></div><div id="tab-group-2998-content-3000" class="tab-pane" data-group="group_2998" tabindex="-1"><div><span><p><a href="https://pulsar.apache.org/admin-rest-api#operation/removeNamespaceMessageTTL?version=2.9.1&amp;apiVersion=v2"><b>DELETE</b> <i>/admin/v2/namespaces/:tenant/:namespace/messageTTL</i></a>
</p>
</span></div></div><div id="tab-group-2998-content-3001" class="tab-pane" data-group="group_2998" tabindex="-1"><div><span><pre><code class="hljs css language-java">admin.namespaces().removeNamespaceMessageTTL(namespace)<br /></code></pre>
</span></div></div></div></div>
<h2><a class="anchor" aria-hidden="true" id="从命名空间中删除消息"></a><a href="#从命名空间中删除消息" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>从命名空间中删除消息</h2>
<p>When it comes to the physical storage size, message expiry and retention are just like two sides of the same coin. * The backlog quota and TTL parameters prevent disk size from growing indefinitely, as Pulsar’s default behaviour is to persist unacknowledged messages. * The retention policy allocates storage space to accommodate the messages that are supposed to be deleted by Pulsar by default.</p>
<p>As a conclusion, the size of your physical storage should accommodate the sum of the backlog quota and the retention size.</p>
<p>The message deletion rate (releasing rate of disk space) can be determined by multiple factors.</p>
<ul>
<li><p><strong>Segment rollover period</strong>: 基础知识，分段滚动周期是创建一个新的分段的频率。 一旦创建新的片段，旧的片段会被删除。 默认情况下，这种情况会在你已写入50,000条条目 (消息) 时或者等待240分钟之后发生。 你可以在broker服务端调整这个策略。</p></li>
<li><p><strong>Entry log rollover period</strong>: BookKeeper 中的多个分类账 ledger 会被相互连接到一个 <a href="https://bookkeeper.apache.org/docs/4.11.1/getting-started/concepts/#entry-logs">entry log</a>中。 对于已删除的 ledger ，必须将条目日志 entry log 全部滚动。 Entry log 滚动周期是可配置的，但完全基于条目日志的大小。 详情参阅 <a href="https://bookkeeper.apache.org/docs/4.11.1/reference/config/#entry-log-settings">这里</a>。 Entry log 一经滚动，就可以进行垃圾回收 entry log。</p></li>
<li><p><strong>垃圾收集间隔</strong>: 因为 entry log 已经跨内部连接了很多ledger, 为了释放空间, 需要重写 entry log。 垃圾收集间隔是 BookKeeper 执行垃圾收集的频率 这与 entry log 的小压缩和大压缩有关。 详情参阅<a href="https://bookkeeper.apache.org/docs/4.11.1/reference/config/#entry-log-compaction-settings">这里</a>。</p></li>
</ul>
<p>The diagram below illustrates one of the cases that the consumed storage size is larger than the given limits for backlog and retention. Messages over the retention limit are kept because other messages in the same segment are still within retention period. <img src="/docs/assets/retention-storage-size.svg" alt=""></p>
<p>If you do not have any retention period and that you never have much of a backlog, the upper limit for retained messages, which are acknowledged, equals to the Pulsar segment rollover period + entry log rollover period + (garbage collection interval * garbage collection ratios).</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/zh-CN/next/cookbooks-non-persistent"><span class="arrow-prev">← </span><span>非持久化消息</span></a><a class="docs-next button" href="/docs/zh-CN/next/cookbooks-encryption"><span>加密</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#消息保留策略">消息保留策略</a><ul class="toc-headings"><li><a href="#默认值">默认值</a></li><li><a href="#设置保留策略">设置保留策略</a></li><li><a href="#获取保留策略">获取保留策略</a></li></ul></li><li><a href="#backlog-quotas">Backlog quotas</a><ul class="toc-headings"><li><a href="#设定大小时间阈值和积压保留政策">设定大小/时间阈值和积压保留政策</a></li><li><a href="#获取积压阈值和积压保留政策">获取积压阈值和积压保留政策</a></li><li><a href="#移除-backlog-quota-策略">移除 backlog quota 策略</a></li><li><a href="#清除积压消息">清除积压消息</a></li></ul></li><li><a href="#生存时间-ttl">生存时间 (TTL)</a><ul class="toc-headings"><li><a href="#设置命名空间的ttl">设置命名空间的TTL</a></li><li><a href="#获取命名空间的-ttl-配置">获取命名空间的 TTL 配置</a></li><li><a href="#删除命名空间的ttl配置">删除命名空间的TTL配置</a></li></ul></li><li><a href="#从命名空间中删除消息">从命名空间中删除消息</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2022 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</section><span><script>
      const community = document.querySelector("a[href='#community']").parentNode;
      const communityMenu =
        '<li>' +
        '<a id="community-menu" href="#">Community <span style="font-size: 0.75em">&nbsp;▼</span></a>' +
        '<div id="community-dropdown" class="hide">' +
          '<ul id="community-dropdown-items">' +
            '<li><a href="/zh-CN/contact">Contact</a></li>' +
            '<li><a href="/zh-CN/contributing">Contributing</a></li>' +
            '<li><a href="/zh-CN/coding-guide">Coding guide</a></li>' +
            '<li><a href="/zh-CN/events">Events</a></li>' +
            '<li><a href="https://twitter.com/Apache_Pulsar" target="_blank">Twitter &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/wiki" target="_blank">Wiki &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/issues" target="_blank">Issue tracking &#x2750</a></li>' +
            '<li><a href="https://pulsar-summit.org/" target="_blank">Pulsar Summit &#x2750</a></li>' +
            '<li>&nbsp;</li>' +
            '<li><a href="/zh-CN/resources">Resources</a></li>' +
            '<li><a href="/zh-CN/team">Team</a></li>' +
            '<li><a href="/zh-CN/powered-by">Powered By</a></li>' +
          '</ul>' +
        '</div>' +
        '</li>';

      community.innerHTML = communityMenu;

      const communityMenuItem = document.getElementById("community-menu");
      const communityDropDown = document.getElementById("community-dropdown");
      communityMenuItem.addEventListener("click", function(event) {
        event.preventDefault();

        if (communityDropDown.className == 'hide') {
          communityDropDown.className = 'visible';
        } else {
          communityDropDown.className = 'hide';
        }
      });
    </script></span></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'd226a455cecdd4bc18a554c1b47e5b52',
                indexName: 'apache_pulsar',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN","version:next"]}
              });
            </script></body></html>