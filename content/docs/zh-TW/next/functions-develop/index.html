<!DOCTYPE html><html lang="zh-TW"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>開發 Pulsar Functions · Apache Pulsar</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="You learn how to develop Pulsar Functions with different APIs for Java, Python and Go."/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="zh-TW"/><meta property="og:title" content="開發 Pulsar Functions · Apache Pulsar"/><meta property="og:type" content="website"/><meta property="og:url" content="https://pulsar.apache.org/"/><meta property="og:description" content="You learn how to develop Pulsar Functions with different APIs for Java, Python and Go."/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://pulsar.apache.org/img/pulsar.svg"/><link rel="shortcut icon" href="/img/pulsar.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://pulsar.apache.org/blog/atom.xml" title="Apache Pulsar Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://pulsar.apache.org/blog/feed.xml" title="Apache Pulsar Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-102219959-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/custom.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-TW"><img class="logo" src="/img/pulsar.svg" alt="Apache Pulsar"/></a><a href="/zh-TW/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/zh-TW/next/standalone" target="_self">Docs</a></li><li class=""><a href="/zh-TW/download" target="_self">Download</a></li><li class="siteNavGroupActive"><a href="/docs/zh-TW/next/client-libraries" target="_self">客戶端</a></li><li class=""><a href="#restapis" target="_self">REST APIs</a></li><li class=""><a href="#cli" target="_self">Cli</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="#community" target="_self">Community</a></li><li class=""><a href="#apache" target="_self">Apache</a></li><li class=""><a href="https://pulsar-next.staged.apache.org/" target="_self">New Website(Beta)</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>繁體中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/next/functions-develop">English</a></li><li><a href="/docs/ja/next/functions-develop">日本語</a></li><li><a href="/docs/fr/next/functions-develop">Français</a></li><li><a href="/docs/ko/next/functions-develop">한국어</a></li><li><a href="/docs/zh-CN/next/functions-develop">中文</a></li><li><a href="https://crowdin.com/project/apache-pulsar" target="_blank" rel="noreferrer noopener">Help Translate</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Pulsar Functions</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Get Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/standalone">在本地運行Pulsar</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/standalone-docker">在Docker中運行Pulsar</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/kubernetes-helm">Run Pulsar in Kubernetes</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Concepts and Architecture</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/concepts-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/concepts-messaging">信息傳送</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/concepts-architecture-overview">Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/concepts-clients">客戶端</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/concepts-replication">基於地理位置的備份複製</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/concepts-multi-tenancy">多租户</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/concepts-authentication">認證和授權</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/concepts-topic-compaction">Toipc 壓實</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/concepts-proxy-sni-routing">Proxy support with SNI routing</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/concepts-multiple-advertised-listeners">Multiple advertised listeners</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar Schema</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/schema-get-started">開始</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/schema-understand">了解 Schema</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/schema-evolution-compatibility">Schema 進化和相容</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/schema-manage">管理 Schema</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar Functions</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/functions-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/functions-runtime">Setup: Configure Functions runtime</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/functions-worker">Setup: Pulsar Functions Worker</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/zh-TW/next/functions-develop">How-to: Develop</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/functions-package">How-to: Package</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/functions-debug">How-to: Debug</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/functions-deploy">How-to: Deploy</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/functions-cli">Reference: CLI</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/window-functions-context">Window Functions: Context</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar IO</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/io-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/io-quickstart">開始</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/io-use">使用方式</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/io-debug">Debug</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/io-connectors">Built-in connector</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/io-cdc">CDC connector</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/io-develop">Develop</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/io-cli">CLI</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar SQL</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/sql-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/sql-getting-started">查詢資料</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/sql-deployment-configurations"> 配置和部署</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/sql-rest-api">REST APIs</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tiered Storage</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/tiered-storage-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/tiered-storage-aws">AWS S3 offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/tiered-storage-gcs">GCS offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/tiered-storage-filesystem">Filesystem offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/tiered-storage-azure">Azure BlobStore offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/tiered-storage-aliyun">Aliyun OSS offloader</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Transactions</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/txn-why">Why transactions?</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/txn-what">What are transactions?</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/txn-how">How transactions work?</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/txn-use">How to use transactions?</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/txn-monitor">How to monitor transactions?</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Kubernetes (Helm)</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/helm-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/helm-prepare">Prepare</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/helm-install">Install</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/helm-deploy">Deployment</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/helm-upgrade">Upgrade</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/helm-tools">Required Tools</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Deployment</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/deploy-aws">Amazon Web Services</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/deploy-kubernetes">Kubernetes</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/deploy-bare-metal">Bare metal</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/deploy-bare-metal-multi-cluster">Bare metal multi-cluster</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/deploy-docker">Docker</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/deploy-monitoring">Monitor</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Administration</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/administration-zk-bk">ZooKeeper and BookKeeper</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/administration-geo">Geo-replication</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/administration-pulsar-manager">Pulsar Manager</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/administration-stats">Pulsar statistics</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/administration-load-balance">Load balance</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/administration-proxy">Pulsar proxy</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/administration-upgrade">Upgrade</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/administration-isolation">Pulsar isolation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Security</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/security-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/security-policy-and-supported-versions">Security Policy and Supported Versions</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/security-tls-transport">Transport Encryption using TLS</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/security-tls-authentication">Authentication using TLS</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/security-tls-keystore">Using TLS with KeyStore configure</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/security-jwt">Authentication using JWT</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/security-athenz">Authentication using Athenz</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/security-kerberos">Authentication using Kerberos</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/security-oauth2">Authentication using OAuth 2.0 access tokens</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/security-authorization">Authorization and ACLs</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/security-encryption">End-to-End Encryption</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/security-extending">Extend Authentication and Authorization</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/security-bouncy-castle">Bouncy Castle Providers</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Performance</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/performance-pulsar-perf">Pulsar Perf</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Client Libraries</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/client-libraries">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/client-libraries-java">Java</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/client-libraries-go">Go</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/client-libraries-python">Python</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/client-libraries-cpp">C++</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/client-libraries-node">Node.js</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/client-libraries-websocket">WebSocket</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/client-libraries-dotnet">C#</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/client-libraries-rest">REST</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Admin API</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/admin-api-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/admin-api-clusters">Clusters</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/admin-api-tenants">Tenants</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/admin-api-brokers">Brokers</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/admin-api-namespaces">Namespaces</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/admin-api-permissions">Permissions</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/admin-api-topics">Topics</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/admin-api-functions">Functions</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/admin-api-packages">Packages</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Adaptors</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/adaptors-kafka">Kafka client wrapper</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/adaptors-spark">Apache Spark</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/adaptors-storm">Apache Storm</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Cookbooks</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/cookbooks-compaction">Topic compaction</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/cookbooks-deduplication">Message deduplication</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/cookbooks-non-persistent">Non-persistent messaging</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/cookbooks-retention-expiry">Message retention and expiry</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/cookbooks-encryption">Encryption</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/cookbooks-message-queue">Message queue</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/cookbooks-bookkeepermetadata">BookKeeper Ledger Metadata</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Development</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/develop-tools">Simulation tools</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/develop-binary-protocol">Binary protocol</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/develop-load-manager">Modular load manager</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/develop-plugin">Plugin</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/reference-terminology">Terminology</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/reference-cli-tools">Pulsar CLI tools</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/reference-configuration">Pulsar configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-TW/next/reference-metrics">Pulsar Metrics</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/apache-pulsar/zh-TW" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">開發 Pulsar Functions</h1></header><article><div><span><p>You learn how to develop Pulsar Functions with different APIs for Java, Python and Go.</p>
<h2><a class="anchor" aria-hidden="true" id="目前支持的-api"></a><a href="#目前支持的-api" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>目前支持的 API</h2>
<p>在 Java 和 Python 中，有兩種​​方式來編寫 Pulsar Functions。 在 Go 中，則可以使用 Pulsar Functions SDK。</p>
<table>
<thead>
<tr><th style="text-align:left">介面</th><th style="text-align:left">說明</th><th style="text-align:left">使用案例</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left">Language-native 介面接口</td><td style="text-align:left">不需要特定的 Pulsar libraries 或特殊依賴 (僅需要 Java/Python 的核心庫)。</td><td style="text-align:left">不需要訪問或使用 function <a href="#context">context</a> 的 functions。</td></tr>
<tr><td style="text-align:left">Java/Python/Go 的 Pulsar Function SDK</td><td style="text-align:left">特定於 Pulsar 的 libraries，提供許多 “native” 接口沒有的額外功能。</td><td style="text-align:left">需要訪問或使用 function <a href="#context">context</a> 的 functions。</td></tr>
<tr><td style="text-align:left">Extended Pulsar Function SDK for Java</td><td style="text-align:left">An extension to Pulsar-specific libraries, providing the initialization and close interfaces in Java.</td><td style="text-align:left">Functions that require initializing and releasing external resources.</td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="language-native-interface"></a><a href="#language-native-interface" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Language-native interface</h3>
<p>Language-native function 沒有外部依賴關係，以下的 function 為所有傳入的字串添加感嘆號，並將結果發佈到 topic。 以下範例展示 language-native function。</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-3250-tab-3251" class="nav-link active" data-group="group_3250" data-tab="tab-group-3250-content-3251">Java</div><div id="tab-group-3250-tab-3252" class="nav-link" data-group="group_3250" data-tab="tab-group-3250-content-3252">Python</div></div><div class="tab-content"><div id="tab-group-3250-content-3251" class="tab-pane active" data-group="group_3250" tabindex="-1"><div><span><pre><code class="hljs css language-Java"><span class="hljs-keyword">import</span> java.util.function.Function;<br /><br /><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JavaNativeExclamationFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">String</span>&gt; </span>{<br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">apply</span><span class="hljs-params">(String input)</span> </span>{<br />        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%s!"</span>, input);<br />    }<br />}<br /></code></pre>
<p>有關完整的代碼，請參見 <a href="https://github.com/apache/pulsar/blob/master/pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/JavaNativeExclamationFunction.java">here</a>。</p>
</span></div></div><div id="tab-group-3250-content-3252" class="tab-pane" data-group="group_3250" tabindex="-1"><div><span><pre><code class="hljs css language-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span><span class="hljs-params">(input)</span>:</span><br />    <span class="hljs-keyword">return</span> <span class="hljs-string">"{}!"</span>.format(input)<br /></code></pre>
<p>有關完整的代碼，請參見 <a href="https://github.com/apache/pulsar/blob/master/pulsar-functions/python-examples/native_exclamation_function.py">here</a>。</p>
<blockquote>
<p>注意 可以在 Python2 或 Python3 中編寫 Pulsar Functions。 但是，Pulsar 只是將 <code>python</code> 作為解譯器。</p>
<p>如果在僅支持 python3 的 Ubuntu 系統上運行 Pulsar Functions，則可能無法運行 functions。 在這種情況下，可以創建 syblink 來解決。 如果在系統中安裝任何依賴於 Python 2.x 的套件，系統都會運行失敗。解決方案仍在開發中 <a href="https://github.com/apache/pulsar/issues/5518">Issue 5518</a>。</p>
<pre><code class="hljs css language-bash">sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 10<br /></code></pre>
</blockquote>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="javapythongo-的-pulsar-function-sdk"></a><a href="#javapythongo-的-pulsar-function-sdk" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Java/Python/Go 的 Pulsar Function SDK</h3>
<p>使用 Pulsar Functions SDK 的範例如下。<div class="tabs"><div class="nav-tabs"><div id="tab-group-3253-tab-3254" class="nav-link active" data-group="group_3253" data-tab="tab-group-3253-content-3254">Java</div><div id="tab-group-3253-tab-3255" class="nav-link" data-group="group_3253" data-tab="tab-group-3253-content-3255">Python</div><div id="tab-group-3253-tab-3256" class="nav-link" data-group="group_3253" data-tab="tab-group-3253-content-3256">Go</div><div id="tab-group-3253-tab-3257" class="nav-link" data-group="group_3253" data-tab="tab-group-3253-content-3257">Java</div></div><div class="tab-content"><div id="tab-group-3253-content-3254" class="tab-pane active" data-group="group_3253" tabindex="-1"><div><span><pre><code class="hljs css language-Java"><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Context;<br /><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Function;<br /><br /><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExclamationFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">String</span>&gt; </span>{<br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">process</span><span class="hljs-params">(String input, Context context)</span> </span>{<br />        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">&quot;%s!&quot;</span>, input);<br />    }<br />}<br /></code></pre></p>
<p>有關完整的代碼，請參見 <a href="https://github.com/apache/pulsar/blob/master/pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/ExclamationFunction.java">here</a>。</p>
</span></div></div><div id="tab-group-3253-content-3255" class="tab-pane" data-group="group_3253" tabindex="-1"><div><span><pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> pulsar <span class="hljs-keyword">import</span> Function<br /><br /><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExclamationFunction</span><span class="hljs-params">(Function)</span>:</span><br />  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span><br />    <span class="hljs-keyword">pass</span><br /><br />  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span><span class="hljs-params">(self, input, context)</span>:</span><br />    <span class="hljs-keyword">return</span> input + <span class="hljs-string">'!'</span><br /></code></pre>
<p>有關完整的代碼，請參見 <a href="https://github.com/apache/pulsar/blob/master/pulsar-functions/python-examples/exclamation_function.py">here</a>。</p>
</span></div></div><div id="tab-group-3253-content-3256" class="tab-pane" data-group="group_3253" tabindex="-1"><div><span><pre><code class="hljs css language-Go"><span class="hljs-keyword">package</span> main<br /><br /><span class="hljs-keyword">import</span> (<br />  <span class="hljs-string">"context"</span><br />  <span class="hljs-string">"fmt"</span><br /><br />  <span class="hljs-string">"github.com/apache/pulsar/pulsar-function-go/pf"</span><br />)<br /><br /><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">HandleRequest</span><span class="hljs-params">(ctx context.Context, in []<span class="hljs-keyword">byte</span>)</span> <span class="hljs-title">error</span></span>{<br />  fmt.Println(<span class="hljs-keyword">string</span>(in) + <span class="hljs-string">"!"</span>)<br />  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br />}<br /><br /><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br />  pf.Start(HandleRequest)<br />}<br /></code></pre>
<h3><a class="anchor" aria-hidden="true" id="extended-pulsar-function-sdk-for-java"></a><a href="#extended-pulsar-function-sdk-for-java" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Extended Pulsar Function SDK for Java</h3>
<p>This extended Pulsar Function SDK provides two additional interfaces to initialize and release external resources.</p>
<ul>
<li>By using the <code>initialize</code> interface, you can initialize external resources which only need one-time initialization when the function instance starts.</li>
<li>By using the <code>close</code> interface, you can close the referenced external resources when the function instance closes.</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>The extended Pulsar Function SDK for Java is available in Pulsar 2.10.0 and later versions. Before using it, you need to set up Pulsar Function worker 2.10.0 or later versions.</p>
</blockquote>
<p>The following example uses the extended interface of Pulsar Function SDK for Java to initialize RedisClient when the function instance starts and release it when the function instance closes.</p>
</span></div></div><div id="tab-group-3253-content-3257" class="tab-pane" data-group="group_3253" tabindex="-1"><div><span><pre><code class="hljs css language-Java"><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Context;<br /><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Function;<br /><span class="hljs-keyword">import</span> io.lettuce.core.RedisClient;<br /><br /><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InitializableFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">String</span>&gt; </span>{<br />    <span class="hljs-keyword">private</span> RedisClient redisClient;<br /><br />    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initRedisClient</span><span class="hljs-params">(Map&lt;String, Object&gt; connectInfo)</span> </span>{<br />        redisClient = RedisClient.create(connectInfo.get(<span class="hljs-string">"redisURI"</span>));<br />    }<br /><br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">(Context context)</span> </span>{<br />        Map&lt;String, Object&gt; connectInfo = context.getUserConfigMap();<br />        redisClient = initRedisClient(connectInfo);<br />    }<br /><br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">process</span><span class="hljs-params">(String input, Context context)</span> </span>{<br />        String value = client.get(key);<br />        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%s-%s"</span>, input, value);<br />    }<br /><br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> </span>{<br />        redisClient.close();<br />    }<br />}<br /></code></pre>
</span></div></div></div></div>
<h2><a class="anchor" aria-hidden="true" id="schema-註冊管理"></a><a href="#schema-註冊管理" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Schema 註冊管理</h2>
<p>Pulsar has a built-in schema registry and is bundled with popular schema types, such as Avro, JSON and Protobuf. Pulsar Functions can leverage the existing schema information from input topics and derive the input type. Schema registry 也適用於輸出的 topic。</p>
<h2><a class="anchor" aria-hidden="true" id="serde"></a><a href="#serde" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SerDe</h2>
<p>SerDe stands for <strong>Ser</strong>ialization and <strong>De</strong>serialization. Pulsar Functions 使用 SerDe 向 Pulsar topic 發布數據或使用其中的數據。 預設情況下，SerDe 的工作方式取決於特定 function 所使用的程式語言。</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-3258-tab-3259" class="nav-link active" data-group="group_3258" data-tab="tab-group-3258-content-3259">Java</div><div id="tab-group-3258-tab-3260" class="nav-link" data-group="group_3258" data-tab="tab-group-3258-content-3260">Python</div><div id="tab-group-3258-tab-3261" class="nav-link" data-group="group_3258" data-tab="tab-group-3258-content-3261">Go</div></div><div class="tab-content"><div id="tab-group-3258-content-3259" class="tab-pane active" data-group="group_3258" tabindex="-1"><div><span><p><code>String</code>, <code>Double</code>, <code>Integer</code>, <code>Float</code>, <code>Long</code>, <code>Short</code>, and <code>Byte</code>.</p>
<p>要自定義 Java 型別，需要實現以下介面接口。</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SerDe</span>&lt;<span class="hljs-title">T</span>&gt; </span>{<br />    <span class="hljs-function">T <span class="hljs-title">deserialize</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] input)</span></span>;<br />    <span class="hljs-keyword">byte</span>[] serialize(T input);<br />}<br /></code></pre>
<p>SerDe works in the following ways in Java Functions. - If the input and output topics have schema, Pulsar Functions use schema for SerDe. - If the input or output topics do not exist, Pulsar Functions adopt the following rules to determine SerDe: - If the schema type is specified, Pulsar Functions use the specified schema type. - If SerDe is specified, Pulsar Functions use the specified SerDe, and the schema type for input and output topics is <code>Byte</code>. - If neither the schema type nor SerDe is specified, Pulsar Functions use the built-in SerDe. For non-primitive schema type, the built-in SerDe serializes and deserializes objects in the <code>JSON</code> format.</p>
</span></div></div><div id="tab-group-3258-content-3260" class="tab-pane" data-group="group_3258" tabindex="-1"><div><span><p>在運行 <a href="/docs/zh-TW/next/functions-deploy#cluster-mode">creating</a> 或 <a href="/docs/zh-TW/next/functions-deploy#local-run-mode">running</a> function 時，可以指定 SerDe。</p>
<pre><code class="hljs css language-bash">$ bin/pulsar-admin <span class="hljs-built_in">functions</span> create \<br />  --tenant public \<br />  --namespace default \<br />  --name my_function \<br />  --py my_function.py \<br />  --classname my_function.MyFunction \<br />  --custom-serde-inputs <span class="hljs-string">'{"input-topic-1":"Serde1","input-topic-2":"Serde2"}'</span> \<br />  --output-serde-classname Serde3 \<br />  --output output-topic-1<br /></code></pre>
<p>此案例包含兩個輸入 topic：<code>input-topic-1</code> 和<code>input-topic-2</code>，它們分別映對到不同的 SerDe 類別 (映對必須指定為 JSON 字串)。 The output topic, <code>output-topic-1</code>, uses the <code>Serde3</code> class for SerDe. 目前，所有 Pulsar Functions 邏輯（包括處理函數和 SerDe 類別）都必須包含在同一個 Python 檔案中。</p>
<p>在將 Pulsar Functions 用於 Python 時，有三個 SerDe 可供選擇：</p>
<ol>
<li>可以使用 <a href="https://github.com/apache/pulsar/blob/master/pulsar-client-cpp/python/pulsar/functions/serde.py#L70"><code>IdentitySerde</code></a>，這樣子信息數據不需要去改變。 <code>IdentitySerDe</code> 是 <strong>預設</strong>的選項。 在未顯式指定 SerDe 的情況下創建或運行 function 即使用此選項。</li>
<li>可以使用 <a href="https://github.com/apache/pulsar/blob/master/pulsar-client-cpp/python/pulsar/functions/serde.py#L62"><code>PickleSerDe</code></a>，將 Python <a href="https://docs.python.org/3/library/pickle.html"><code>pickle</code></a> 用於 SerDe。</li>
<li>你可以通過實現基底類別來創建自定義 SerDe <a href="https://github.com/apache/pulsar/blob/master/pulsar-client-cpp/python/pulsar/functions/serde.py#L50"><code>SerDe</code></a> 類別，它只有兩個方法需要實作：<a href="https://github.com/apache/pulsar/blob/master/pulsar-client-cpp/python/pulsar/functions/serde.py#L53"><code>serialize</code></a> 用來轉換 object 成為 bytes, 另外 <a href="https://github.com/apache/pulsar/blob/master/pulsar-client-cpp/python/pulsar/functions/serde.py#L58"><code>deserialize</code></a> 用來轉換 bytes 回到 object。</li>
</ol>
<p>下表顯示了每個 SerDe 的使用情境。</p>
<table>
<thead>
<tr><th style="text-align:left">SerDe 類別</th><th style="text-align:left">何時該使用</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>IdentitySerde</code></td><td style="text-align:left">在使用簡單資料型別（如：字串、布林值、整數）時。</td></tr>
<tr><td style="text-align:left"><code>PickleSerDe</code></td><td style="text-align:left">在使用複雜的、特定於某種應用程序的資料型別，並且適用於 <code>pickle</code> 的 “best effort” 方法來進行型別 SerDe。</td></tr>
<tr><td style="text-align:left">Custom SerDe</td><td style="text-align:left">在需要對於 SerDe 有高度的控制 (可能是出於性能或數據相容性的考量) 時。</td></tr>
</tbody>
</table>
</span></div></div><div id="tab-group-3258-content-3261" class="tab-pane" data-group="group_3258" tabindex="-1"><div><span></span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="example"></a><a href="#example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h3>
<p>Imagine that you're writing Pulsar Functions that are processing tweet objects, you can refer to the following example of <code>Tweet</code> class.</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-3262-tab-3263" class="nav-link active" data-group="group_3262" data-tab="tab-group-3262-content-3263">Java</div><div id="tab-group-3262-tab-3264" class="nav-link" data-group="group_3262" data-tab="tab-group-3262-content-3264">Python</div></div><div class="tab-content"><div id="tab-group-3262-content-3263" class="tab-pane active" data-group="group_3262" tabindex="-1"><div><span><pre><code class="hljs css language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Tweet</span> </span>{<br />    <span class="hljs-keyword">private</span> String username;<br />    <span class="hljs-keyword">private</span> String tweetContent;<br /><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Tweet</span><span class="hljs-params">(String username, String tweetContent)</span> </span>{<br />        <span class="hljs-keyword">this</span>.username = username;<br />        <span class="hljs-keyword">this</span>.tweetContent = tweetContent;<br />    }<br /><br />    <span class="hljs-comment">// Standard setters and getters</span><br />}<br /></code></pre>
<p>To pass <code>Tweet</code> objects directly between Pulsar Functions, you need to provide a custom SerDe class. In the example below, <code>Tweet</code> objects are basically strings in which the username and tweet content are separated by a <code>|</code>.</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">package</span> com.example.serde;<br /><br /><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.SerDe;<br /><br /><span class="hljs-keyword">import</span> java.util.regex.Pattern;<br /><br /><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TweetSerde</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">SerDe</span>&lt;<span class="hljs-title">Tweet</span>&gt; </span>{<br />    <span class="hljs-function"><span class="hljs-keyword">public</span> Tweet <span class="hljs-title">deserialize</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] input)</span> </span>{<br />        String s = <span class="hljs-keyword">new</span> String(input);<br />        String[] fields = s.split(Pattern.quote(<span class="hljs-string">"|"</span>));<br />        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Tweet(fields[<span class="hljs-number">0</span>], fields[<span class="hljs-number">1</span>]);<br />    }<br /><br />    <span class="hljs-keyword">public</span> <span class="hljs-keyword">byte</span>[] serialize(Tweet input) {<br />        <span class="hljs-keyword">return</span> <span class="hljs-string">"%s|%s"</span>.format(input.getUsername(), input.getTweetContent()).getBytes();<br />    }<br />}<br /></code></pre>
<p>To apply this customized SerDe to a particular Pulsar Function, you need to:</p>
<ul>
<li>將 <code>Tweet</code> 和 <code>TweetSerde</code> 類別打包到一個 JAR 中。</li>
<li>部署 function 時，指定 JAR 和 SerDe 類別名稱的路徑。</li>
</ul>
<p>The following is an example of <a href="/docs/zh-TW/next/pulsar-admin#create-1"><code>create</code></a> operation.</p>
<pre><code class="hljs css language-bash">$ bin/pulsar-admin <span class="hljs-built_in">functions</span> create \<br />  --jar /path/to/your.jar \<br />  --output-serde-classname com.example.serde.TweetSerde \<br />  <span class="hljs-comment"># Other function attributes</span><br /></code></pre>
<blockquote>
<h4><a class="anchor" aria-hidden="true" id="custom-serde-classes-must-be-packaged-with-your-function-jars"></a><a href="#custom-serde-classes-must-be-packaged-with-your-function-jars" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Custom SerDe classes must be packaged with your function JARs</h4>
<p>Pulsar does not store your custom SerDe classes separately from your Pulsar Functions. 因此，需要在 function 的 JAR 中包含 SerDe 類別。 如果不是這麼做，那麼 Pulsar 會返回錯誤。</p>
</blockquote>
</span></div></div><div id="tab-group-3262-content-3264" class="tab-pane" data-group="group_3262" tabindex="-1"><div><span><pre><code class="hljs css language-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Tweet</span><span class="hljs-params">(object)</span>:</span><br />    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, username, tweet_content)</span>:</span><br />        self.username = username<br />        self.tweet_content = tweet_content<br /></code></pre>
<p>In order to use this class in Pulsar Functions, you have two options:</p>
<ol>
<li>你可以指定 <code>PickleSerDe</code>，它應用 <a href="https://docs.python.org/3/library/pickle.html"><code>pickle</code></a> 函式庫來進行 SerDe。</li>
<li>你可以創建自己的 SerDe 類別。 以下是一個範例。</li>
</ol>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> pulsar <span class="hljs-keyword">import</span> SerDe<br /><br /><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TweetSerDe</span><span class="hljs-params">(SerDe)</span>:</span><br /><br />    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">serialize</span><span class="hljs-params">(self, input)</span>:</span><br />        <span class="hljs-keyword">return</span> bytes(<span class="hljs-string">"{0}|{1}"</span>.format(input.username, input.tweet_content))<br /><br />    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">deserialize</span><span class="hljs-params">(self, input_bytes)</span>:</span><br />        tweet_components = str(input_bytes).split(<span class="hljs-string">'|'</span>)<br />        <span class="hljs-keyword">return</span> Tweet(tweet_components[<span class="hljs-number">0</span>], tweet_componentsp[<span class="hljs-number">1</span>])<br /></code></pre>
<p>For complete code, see <a href="https://github.com/apache/pulsar/blob/master/pulsar-functions/python-examples/custom_object_function.py">here</a>.</p>
</span></div></div></div></div>
<p>在這兩種語言中，你都可以為更複雜的，特定於應用程序的類型編寫自定義 SerDe 邏輯。</p>
<h2><a class="anchor" aria-hidden="true" id="context"></a><a href="#context" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Context</h2>
<p>Java, Python and Go SDKs 提供可被 function 應用訪問的 <strong>context object</strong> 。
這個 context object 為 function 提供了各種各樣的訊息和功能。</p>
<ul>
<li>Pulsar Function 的名稱和 ID。</li>
<li>每個信息的信息 ID。 每個 Pulsar 信息都會自動分配一個 ID。</li>
<li>每個信息的信息 key、event time、properties 與 partition key。</li>
<li>信息發送到的 topic 名稱。</li>
<li>與該 function 相關聯的所有輸入/輸出 topic 的名稱。</li>
<li>用於 [SerDe] (#serde) 的類別名稱。</li>
<li>與該 function 相關聯的 <a href="/docs/zh-TW/next/reference-terminology#tenant">tenant</a> 與 namespace。</li>
<li>運行該 function 的 Pulsar Functions 實例 ID。</li>
<li>該 function 的版本。</li>
<li>該 function 用來產生 function 日誌信息的 <a href="/docs/zh-TW/next/functions-develop#logger">logger object</a> 。</li>
<li>訪問通過 CLI 所傳遞進來的 <a href="#user-config">user configuration</a> 值。</li>
<li>一個用來記錄 <a href="#metrics">metrics</a> 的介面接口。</li>
<li>一個用於在 <a href="#state-storage">state storage</a> 中存儲和檢索 state 的介面接口。</li>
<li>一個能夠新信息發佈到任意 topic 的 function。</li>
<li>一個能夠對正在處理的消息進行 ack 的 function（如果沒有啟動 自動確認）。</li>
<li>(Java) get Pulsar admin client.</li>
</ul>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-3265-tab-3266" class="nav-link active" data-group="group_3265" data-tab="tab-group-3265-content-3266">Java</div><div id="tab-group-3265-tab-3267" class="nav-link" data-group="group_3265" data-tab="tab-group-3265-content-3267">Python</div><div id="tab-group-3265-tab-3268" class="nav-link" data-group="group_3265" data-tab="tab-group-3265-content-3268">Go</div></div><div class="tab-content"><div id="tab-group-3265-content-3266" class="tab-pane active" data-group="group_3265" tabindex="-1"><div><span><p>這個 <a href="https://github.com/apache/pulsar/blob/master/pulsar-functions/api-java/src/main/java/org/apache/pulsar/functions/api/Context.java">Context</a> 界面接口提供了許多方法，可用於訪問該 <a href="#context">context</a> 。 下面列出了 Context 介面接口的各種方法。</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Context</span> </span>{<br />    Record&lt;?&gt; getCurrentRecord();<br />    <span class="hljs-function">Collection&lt;String&gt; <span class="hljs-title">getInputTopics</span><span class="hljs-params">()</span></span>;<br />    <span class="hljs-function">String <span class="hljs-title">getOutputTopic</span><span class="hljs-params">()</span></span>;<br />    <span class="hljs-function">String <span class="hljs-title">getOutputSchemaType</span><span class="hljs-params">()</span></span>;<br />    <span class="hljs-function">String <span class="hljs-title">getTenant</span><span class="hljs-params">()</span></span>;<br />    <span class="hljs-function">String <span class="hljs-title">getNamespace</span><span class="hljs-params">()</span></span>;<br />    <span class="hljs-function">String <span class="hljs-title">getFunctionName</span><span class="hljs-params">()</span></span>;<br />    <span class="hljs-function">String <span class="hljs-title">getFunctionId</span><span class="hljs-params">()</span></span>;<br />    <span class="hljs-function">String <span class="hljs-title">getInstanceId</span><span class="hljs-params">()</span></span>;<br />    <span class="hljs-function">String <span class="hljs-title">getFunctionVersion</span><span class="hljs-params">()</span></span>;<br />    <span class="hljs-function">Logger <span class="hljs-title">getLogger</span><span class="hljs-params">()</span></span>;<br />    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">incrCounter</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> amount)</span></span>;<br />    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">incrCounterAsync</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> amount)</span></span>;<br />    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">getCounter</span><span class="hljs-params">(String key)</span></span>;<br />    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">getCounterAsync</span><span class="hljs-params">(String key)</span></span>;<br />    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">putState</span><span class="hljs-params">(String key, ByteBuffer value)</span></span>;<br />    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">putStateAsync</span><span class="hljs-params">(String key, ByteBuffer value)</span></span>;<br />    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteState</span><span class="hljs-params">(String key)</span></span>;<br />    <span class="hljs-function">ByteBuffer <span class="hljs-title">getState</span><span class="hljs-params">(String key)</span></span>;<br />    <span class="hljs-function">ByteBuffer <span class="hljs-title">getStateAsync</span><span class="hljs-params">(String key)</span></span>;<br />    <span class="hljs-function">Map&lt;String, Object&gt; <span class="hljs-title">getUserConfigMap</span><span class="hljs-params">()</span></span>;<br />    <span class="hljs-function">Optional&lt;Object&gt; <span class="hljs-title">getUserConfigValue</span><span class="hljs-params">(String key)</span></span>;<br />    <span class="hljs-function">Object <span class="hljs-title">getUserConfigValueOrDefault</span><span class="hljs-params">(String key, Object defaultValue)</span></span>;<br />    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">recordMetric</span><span class="hljs-params">(String metricName, <span class="hljs-keyword">double</span> value)</span></span>;<br />    &lt;O&gt; <span class="hljs-function">CompletableFuture&lt;Void&gt; <span class="hljs-title">publish</span><span class="hljs-params">(String topicName, O object, String schemaOrSerdeClassName)</span></span>;<br />    &lt;O&gt; <span class="hljs-function">CompletableFuture&lt;Void&gt; <span class="hljs-title">publish</span><span class="hljs-params">(String topicName, O object)</span></span>;<br />    &lt;O&gt; <span class="hljs-function">TypedMessageBuilder&lt;O&gt; <span class="hljs-title">newOutputMessage</span><span class="hljs-params">(String topicName, Schema&lt;O&gt; schema)</span> <span class="hljs-keyword">throws</span> PulsarClientException</span>;<br />    &lt;O&gt; <span class="hljs-function">ConsumerBuilder&lt;O&gt; <span class="hljs-title">newConsumerBuilder</span><span class="hljs-params">(Schema&lt;O&gt; schema)</span> <span class="hljs-keyword">throws</span> PulsarClientException</span>;<br />    <span class="hljs-function">PulsarAdmin <span class="hljs-title">getPulsarAdmin</span><span class="hljs-params">()</span></span>;<br />    <span class="hljs-function">PulsarAdmin <span class="hljs-title">getPulsarAdmin</span><span class="hljs-params">(String clusterName)</span></span>;<br />}<br /></code></pre>
<p>The following example uses several methods available via the <code>Context</code> object.</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Context;<br /><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Function;<br /><span class="hljs-keyword">import</span> org.slf4j.Logger;<br /><br /><span class="hljs-keyword">import</span> java.util.stream.Collectors;<br /><br /><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContextFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Void</span>&gt; </span>{<br />    <span class="hljs-function"><span class="hljs-keyword">public</span> Void <span class="hljs-title">process</span><span class="hljs-params">(String input, Context context)</span> </span>{<br />        Logger LOG = context.getLogger();<br />        String inputTopics = context.getInputTopics().stream().collect(Collectors.joining(<span class="hljs-string">", "</span>));<br />        String functionName = context.getFunctionName();<br /><br />        String logMessage = String.format(<span class="hljs-string">"A message with a value of \"%s\" has arrived on one of the following topics: %s\n"</span>,<br />                input,<br />                inputTopics);<br /><br />        LOG.info(logMessage);<br /><br />        String metricName = String.format(<span class="hljs-string">"function-%s-messages-received"</span>, functionName);<br />        context.recordMetric(metricName, <span class="hljs-number">1</span>);<br /><br />        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br />    }<br />}<br /></code></pre>
</span></div></div><div id="tab-group-3265-content-3267" class="tab-pane" data-group="group_3265" tabindex="-1"><div><span><pre><code class="hljs">class ContextImpl(pulsar.Context):<br />  def get_message_id(self):<br />    ...<br />  def get_message_key(self):<br />    ...<br />  def get_message_eventtime(self):<br />    ...<br />  def get_message_properties(self):<br />    ...<br />  def get_current_message_topic_name(self):<br />    ...<br />  def get_partition_key(self):<br />    ...<br />  def get_function_name(self):<br />    ...<br />  def get_function_tenant(self):<br />    ...<br />  def get_function_namespace(self):<br />    ...<br />  def get_function_id(self):<br />    ...<br />  def get_instance_id(self):<br />    ...<br />  def get_function_version(self):<br />    ...<br />  def get_logger(self):<br />    ...<br />  def get_user_config_value(self, key):<br />    ...<br />  def get_user_config_map(self):<br />    ...<br />  def record_metric(self, metric_name, metric_value):<br />    ...<br />  def get_input_topics(self):<br />    ...<br />  def get_output_topic(self):<br />    ...<br />  def get_output_serde_class_name(self):<br />    ...<br />  def publish(self, topic_name, message, serde_class_name=&quot;serde.IdentitySerDe&quot;,<br />              properties=None, compression_type=None, callback=None, message_conf=None):<br />    ...<br />  def ack(self, msgid, topic):<br />    ...<br />  def get_and_reset_metrics(self):<br />    ...<br />  def reset_metrics(self):<br />    ...<br />  def get_metrics(self):<br />    ...<br />  def incr_counter(self, key, amount):<br />    ...<br />  def get_counter(self, key):<br />    ...<br />  def del_counter(self, key):<br />    ...<br />  def put_state(self, key, value):<br />    ...<br />  def get_state(self, key):<br />    ...<br /></code></pre>
</span></div></div><div id="tab-group-3265-content-3268" class="tab-pane" data-group="group_3265" tabindex="-1"><div><span><pre><code class="hljs">func (c *FunctionContext) GetInstanceID() int {<br />  return c.instanceConf.instanceID<br />}<br /><br />func (c *FunctionContext) GetInputTopics() []string {<br />  return c.inputTopics<br />}<br /><br />func (c *FunctionContext) GetOutputTopic() string {<br />  return c.instanceConf.funcDetails.GetSink().Topic<br />}<br /><br />func (c *FunctionContext) GetFuncTenant() string {<br />  return c.instanceConf.funcDetails.Tenant<br />}<br /><br />func (c *FunctionContext) GetFuncName() string {<br />  return c.instanceConf.funcDetails.Name<br />}<br /><br />func (c *FunctionContext) GetFuncNamespace() string {<br />  return c.instanceConf.funcDetails.Namespace<br />}<br /><br />func (c *FunctionContext) GetFuncID() string {<br />  return c.instanceConf.funcID<br />}<br /><br />func (c *FunctionContext) GetFuncVersion() string {<br />  return c.instanceConf.funcVersion<br />}<br /><br />func (c *FunctionContext) GetUserConfValue(key string) interface{} {<br />  return c.userConfigs[key]<br />}<br /><br />func (c *FunctionContext) GetUserConfMap() map[string]interface{} {<br />  return c.userConfigs<br />}<br /><br />func (c *FunctionContext) SetCurrentRecord(record pulsar.Message) {<br />  c.record = record<br />}<br /><br />func (c *FunctionContext) GetCurrentRecord() pulsar.Message {<br />  return c.record<br />}<br /><br />func (c *FunctionContext) NewOutputMessage(topic string) pulsar.Producer {<br />  return c.outputMessage(topic)<br />}<br /></code></pre>
<p>The following example uses several methods available via the <code>Context</code> object.</p>
<pre><code class="hljs">import (<br />    &quot;context&quot;<br />    &quot;fmt&quot;<br /><br />    &quot;github.com/apache/pulsar/pulsar-function-go/pf&quot;<br />)<br /><br />func contextFunc(ctx context.Context) {<br />    if fc, ok := pf.FromContext(ctx); ok {<br />        fmt.Printf(&quot;function ID is:%s, &quot;, fc.GetFuncID())<br />        fmt.Printf(&quot;function version is:%s\n&quot;, fc.GetFuncVersion())<br />    }<br />}<br /></code></pre>
<p>For complete code, see <a href="https://github.com/apache/pulsar/blob/77cf09eafa4f1626a53a1fe2e65dd25f377c1127/pulsar-function-go/examples/contextFunc/contextFunc.go#L29-L34">here</a>.</p>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="user-config"></a><a href="#user-config" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>User config</h3>
<p>When you run or update Pulsar Functions created using SDK, you can pass arbitrary key/values to them with the command line with the <code>--user-config</code> flag. Key/values must be specified as JSON. The following function creation command passes a user configured key/value to a function.</p>
<pre><code class="hljs css language-bash">$ bin/pulsar-admin <span class="hljs-built_in">functions</span> create \
  --name word-filter \
  <span class="hljs-comment"># Other function configs</span>
  --user-config <span class="hljs-string">'{"forbidden-word":"rosebud"}'</span>
</code></pre>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-3269-tab-3270" class="nav-link active" data-group="group_3269" data-tab="tab-group-3269-content-3270">Java</div><div id="tab-group-3269-tab-3271" class="nav-link" data-group="group_3269" data-tab="tab-group-3269-content-3271">Python</div><div id="tab-group-3269-tab-3272" class="nav-link" data-group="group_3269" data-tab="tab-group-3269-content-3272">Go</div></div><div class="tab-content"><div id="tab-group-3269-content-3270" class="tab-pane active" data-group="group_3269" tabindex="-1"><div><span><p><a href="#context"><code>Context</code></a> object enables you to access key/value pairs provided to Pulsar Functions via the command line (as JSON). The following example passes a key/value pair.</p>
<pre><code class="hljs css language-bash">$ bin/pulsar-admin <span class="hljs-built_in">functions</span> create \<br />  <span class="hljs-comment"># Other function configs</span><br />  --user-config <span class="hljs-string">'{"word-of-the-day":"verdure"}'</span><br /></code></pre>
<p>To access that value in a Java function:</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Context;<br /><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Function;<br /><span class="hljs-keyword">import</span> org.slf4j.Logger;<br /><br /><span class="hljs-keyword">import</span> java.util.Optional;<br /><br /><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserConfigFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Void</span>&gt; </span>{<br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">apply</span><span class="hljs-params">(String input, Context context)</span> </span>{<br />        Logger LOG = context.getLogger();<br />        Optional&lt;String&gt; wotd = context.getUserConfigValue(<span class="hljs-string">"word-of-the-day"</span>);<br />        <span class="hljs-keyword">if</span> (wotd.isPresent()) {<br />            LOG.info(<span class="hljs-string">"The word of the day is {}"</span>, wotd);<br />        } <span class="hljs-keyword">else</span> {<br />            LOG.warn(<span class="hljs-string">"No word of the day provided"</span>);<br />        }<br />        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br />    }<br />}<br /></code></pre>
<p>The <code>UserConfigFunction</code> function will log the string <code>&quot;The word of the day is verdure&quot;</code> every time the function is invoked (which means every time a message arrives). The <code>word-of-the-day</code> user config will be changed only when the function is updated with a new config value via the command line.</p>
<p>You can also access the entire user config map or set a default value in case no value is present:</p>
<pre><code class="hljs css language-java"><span class="hljs-comment">// Get the whole config map</span><br />Map&lt;String, String&gt; allConfigs = context.getUserConfigMap();<br /><br /><span class="hljs-comment">// Get value or resort to default</span><br />String wotd = context.getUserConfigValueOrDefault(<span class="hljs-string">"word-of-the-day"</span>, <span class="hljs-string">"perspicacious"</span>);<br /></code></pre>
<blockquote>
<p>對於傳遞給 Java function 的所有 key/value 對，<em>key</em> 和 <em>value</em> 均為 <code>String</code>。 若要將 vlue 設置為其他型別，你需要從 <code>String</code> 型別來進行反序列化。</p>
</blockquote>
</span></div></div><div id="tab-group-3269-content-3271" class="tab-pane" data-group="group_3269" tabindex="-1"><div><span><pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> pulsar <span class="hljs-keyword">import</span> Function<br /><br /><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WordFilter</span><span class="hljs-params">(Function)</span>:</span><br />    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span><span class="hljs-params">(self, context, input)</span>:</span><br />        forbidden_word = context.user_config()[<span class="hljs-string">"forbidden-word"</span>]<br /><br />        <span class="hljs-comment"># Don't publish the message if it contains the user-supplied</span><br />        <span class="hljs-comment"># forbidden word</span><br />        <span class="hljs-keyword">if</span> forbidden_word <span class="hljs-keyword">in</span> input:<br />            <span class="hljs-keyword">pass</span><br />        <span class="hljs-comment"># Otherwise publish the message</span><br />        <span class="hljs-keyword">else</span>:<br />            <span class="hljs-keyword">return</span> input<br /></code></pre>
<p>The Python SDK <a href="#context"><code>Context</code></a> object enables you to access key/value pairs provided to Pulsar Functions via the command line (as JSON). The following example passes a key/value pair.</p>
<pre><code class="hljs css language-bash">$ bin/pulsar-admin <span class="hljs-built_in">functions</span> create \<br />  <span class="hljs-comment"># Other function configs \</span><br />  --user-config <span class="hljs-string">'{"word-of-the-day":"verdure"}'</span><br /></code></pre>
<p>To access that value in a Python function:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> pulsar <span class="hljs-keyword">import</span> Function<br /><br /><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserConfigFunction</span><span class="hljs-params">(Function)</span>:</span><br />    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span><span class="hljs-params">(self, input, context)</span>:</span><br />        logger = context.get_logger()<br />        wotd = context.get_user_config_value(<span class="hljs-string">'word-of-the-day'</span>)<br />        <span class="hljs-keyword">if</span> wotd <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br />            logger.warn(<span class="hljs-string">'No word of the day provided'</span>)<br />        <span class="hljs-keyword">else</span>:<br />            logger.info(<span class="hljs-string">"The word of the day is {0}"</span>.format(wotd))<br /></code></pre>
</span></div></div><div id="tab-group-3269-content-3272" class="tab-pane" data-group="group_3269" tabindex="-1"><div><span><p>The Go SDK <a href="#context"><code>Context</code></a> object enables you to access key/value pairs provided to Pulsar Functions via the command line (as JSON). The following example passes a key/value pair.</p>
<pre><code class="hljs css language-bash">$ bin/pulsar-admin <span class="hljs-built_in">functions</span> create \<br />  --go path/to/go/binary<br />  --user-config <span class="hljs-string">'{"word-of-the-day":"lackadaisical"}'</span><br /></code></pre>
<p>To access that value in a Go function:</p>
<pre><code class="hljs css language-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">contextFunc</span><span class="hljs-params">(ctx context.Context)</span></span> {<br />  fc, ok := pf.FromContext(ctx)<br />  <span class="hljs-keyword">if</span> !ok {<br />    logutil.Fatal(<span class="hljs-string">"Function context is not defined"</span>)<br />  }<br /><br />  wotd := fc.GetUserConfValue(<span class="hljs-string">"word-of-the-day"</span>)<br /><br />  <span class="hljs-keyword">if</span> wotd == <span class="hljs-literal">nil</span> {<br />    logutil.Warn(<span class="hljs-string">"The word of the day is empty"</span>)<br />  } <span class="hljs-keyword">else</span> {<br />    logutil.Infof(<span class="hljs-string">"The word of the day is %s"</span>, wotd.(<span class="hljs-keyword">string</span>))<br />  }<br />}<br /></code></pre>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="logger"></a><a href="#logger" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Logger</h3>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-3273-tab-3274" class="nav-link active" data-group="group_3273" data-tab="tab-group-3273-content-3274">Java</div><div id="tab-group-3273-tab-3275" class="nav-link" data-group="group_3273" data-tab="tab-group-3273-content-3275">Python</div><div id="tab-group-3273-tab-3276" class="nav-link" data-group="group_3273" data-tab="tab-group-3273-content-3276">Go</div></div><div class="tab-content"><div id="tab-group-3273-content-3274" class="tab-pane active" data-group="group_3273" tabindex="-1"><div><span><p><a href="https://www.slf4j.org/">SLF4j</a> <a href="https://www.slf4j.org/api/org/apache/log4j/Logger.html"><code>Logger</code></a> object that can be used to produce logs at the chosen log level. The following example logs either a <code>WARNING</code>- or <code>INFO</code>-level log based on whether the incoming string contains the word <code>danger</code>.</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Context;<br /><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Function;<br /><span class="hljs-keyword">import</span> org.slf4j.Logger;<br /><br /><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoggingFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Void</span>&gt; </span>{<br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">apply</span><span class="hljs-params">(String input, Context context)</span> </span>{<br />        Logger LOG = context.getLogger();<br />        String messageId = <span class="hljs-keyword">new</span> String(context.getMessageId());<br /><br />        <span class="hljs-keyword">if</span> (input.contains(<span class="hljs-string">"danger"</span>)) {<br />            LOG.warn(<span class="hljs-string">"A warning was received in message {}"</span>, messageId);<br />        } <span class="hljs-keyword">else</span> {<br />            LOG.info(<span class="hljs-string">"Message {} received\nContent: {}"</span>, messageId, input);<br />        }<br /><br />        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br />    }<br />}<br /></code></pre>
<p>If you want your function to produce logs, you need to specify a log topic when creating or running the function. The following is an example.</p>
<pre><code class="hljs css language-bash">$ bin/pulsar-admin <span class="hljs-built_in">functions</span> create \<br />  --jar my-functions.jar \<br />  --classname my.package.LoggingFunction \<br />  --<span class="hljs-built_in">log</span>-topic persistent://public/default/logging-function-logs \<br />  <span class="hljs-comment"># Other function configs</span><br /></code></pre>
<p>All logs produced by <code>LoggingFunction</code> above can be accessed via the <code>persistent://public/default/logging-function-logs</code> topic.</p>
<h4><a class="anchor" aria-hidden="true" id="customize-function-log-level"></a><a href="#customize-function-log-level" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Customize Function log level</h4>
<p>Additionally, you can use the XML file, <code>functions_log4j2.xml</code>, to customize the function log level. To customize the function log level, create or update <code>functions_log4j2.xml</code> in your Pulsar conf directory (for example, <code>/etc/pulsar/</code> on bare-metal, or <code>/pulsar/conf</code> on Kubernetes) to contain contents such as:</p>
<pre><code class="hljs css language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Configuration</span>&gt;</span><br />    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>pulsar-functions-instance<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br />    <span class="hljs-tag">&lt;<span class="hljs-name">monitorInterval</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-name">monitorInterval</span>&gt;</span><br />    <span class="hljs-tag">&lt;<span class="hljs-name">Properties</span>&gt;</span><br />        <span class="hljs-tag">&lt;<span class="hljs-name">Property</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>pulsar.log.appender<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>RollingFile<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br />        <span class="hljs-tag">&lt;/<span class="hljs-name">Property</span>&gt;</span><br />        <span class="hljs-tag">&lt;<span class="hljs-name">Property</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>pulsar.log.level<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>debug<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br />        <span class="hljs-tag">&lt;/<span class="hljs-name">Property</span>&gt;</span><br />        <span class="hljs-tag">&lt;<span class="hljs-name">Property</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>bk.log.level<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>debug<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br />        <span class="hljs-tag">&lt;/<span class="hljs-name">Property</span>&gt;</span><br />    <span class="hljs-tag">&lt;/<span class="hljs-name">Properties</span>&gt;</span><br />    <span class="hljs-tag">&lt;<span class="hljs-name">Appenders</span>&gt;</span><br />        <span class="hljs-tag">&lt;<span class="hljs-name">Console</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Console<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>SYSTEM_OUT<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>%d{ISO8601_OFFSET_DATE_TIME_HHMM} [%t] %-5level %logger{36} - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br />            <span class="hljs-tag">&lt;/<span class="hljs-name">PatternLayout</span>&gt;</span><br />        <span class="hljs-tag">&lt;/<span class="hljs-name">Console</span>&gt;</span><br />        <span class="hljs-tag">&lt;<span class="hljs-name">RollingFile</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>RollingFile<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">fileName</span>&gt;</span>${sys:pulsar.function.log.dir}/${sys:pulsar.function.log.file}.log<span class="hljs-tag">&lt;/<span class="hljs-name">fileName</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">filePattern</span>&gt;</span>${sys:pulsar.function.log.dir}/${sys:pulsar.function.log.file}-%d{MM-dd-yyyy}-%i.log.gz<span class="hljs-tag">&lt;/<span class="hljs-name">filePattern</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">immediateFlush</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">immediateFlush</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>%d{ISO8601_OFFSET_DATE_TIME_HHMM} [%t] %-5level %logger{36} - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br />            <span class="hljs-tag">&lt;/<span class="hljs-name">PatternLayout</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">interval</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">interval</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">modulate</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">modulate</span>&gt;</span><br />                <span class="hljs-tag">&lt;/<span class="hljs-name">TimeBasedTriggeringPolicy</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">size</span>&gt;</span>1 GB<span class="hljs-tag">&lt;/<span class="hljs-name">size</span>&gt;</span><br />                <span class="hljs-tag">&lt;/<span class="hljs-name">SizeBasedTriggeringPolicy</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">CronTriggeringPolicy</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">schedule</span>&gt;</span>0 0 0 * * ?<span class="hljs-tag">&lt;/<span class="hljs-name">schedule</span>&gt;</span><br />                <span class="hljs-tag">&lt;/<span class="hljs-name">CronTriggeringPolicy</span>&gt;</span><br />            <span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">DefaultRolloverStrategy</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">Delete</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">basePath</span>&gt;</span>${sys:pulsar.function.log.dir}<span class="hljs-tag">&lt;/<span class="hljs-name">basePath</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">maxDepth</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">maxDepth</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">IfFileName</span>&gt;</span><br />                        <span class="hljs-tag">&lt;<span class="hljs-name">glob</span>&gt;</span>*/${sys:pulsar.function.log.file}*log.gz<span class="hljs-tag">&lt;/<span class="hljs-name">glob</span>&gt;</span><br />                    <span class="hljs-tag">&lt;/<span class="hljs-name">IfFileName</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">IfLastModified</span>&gt;</span><br />                        <span class="hljs-tag">&lt;<span class="hljs-name">age</span>&gt;</span>30d<span class="hljs-tag">&lt;/<span class="hljs-name">age</span>&gt;</span><br />                    <span class="hljs-tag">&lt;/<span class="hljs-name">IfLastModified</span>&gt;</span><br />                <span class="hljs-tag">&lt;/<span class="hljs-name">Delete</span>&gt;</span><br />            <span class="hljs-tag">&lt;/<span class="hljs-name">DefaultRolloverStrategy</span>&gt;</span><br />        <span class="hljs-tag">&lt;/<span class="hljs-name">RollingFile</span>&gt;</span><br />        <span class="hljs-tag">&lt;<span class="hljs-name">RollingRandomAccessFile</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>BkRollingFile<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">fileName</span>&gt;</span>${sys:pulsar.function.log.dir}/${sys:pulsar.function.log.file}.bk<span class="hljs-tag">&lt;/<span class="hljs-name">fileName</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">filePattern</span>&gt;</span>${sys:pulsar.function.log.dir}/${sys:pulsar.function.log.file}.bk-%d{MM-dd-yyyy}-%i.log.gz<span class="hljs-tag">&lt;/<span class="hljs-name">filePattern</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">immediateFlush</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">immediateFlush</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>%d{ISO8601_OFFSET_DATE_TIME_HHMM} [%t] %-5level %logger{36} - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br />            <span class="hljs-tag">&lt;/<span class="hljs-name">PatternLayout</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">interval</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">interval</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">modulate</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">modulate</span>&gt;</span><br />                <span class="hljs-tag">&lt;/<span class="hljs-name">TimeBasedTriggeringPolicy</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">size</span>&gt;</span>1 GB<span class="hljs-tag">&lt;/<span class="hljs-name">size</span>&gt;</span><br />                <span class="hljs-tag">&lt;/<span class="hljs-name">SizeBasedTriggeringPolicy</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">CronTriggeringPolicy</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">schedule</span>&gt;</span>0 0 0 * * ?<span class="hljs-tag">&lt;/<span class="hljs-name">schedule</span>&gt;</span><br />                <span class="hljs-tag">&lt;/<span class="hljs-name">CronTriggeringPolicy</span>&gt;</span><br />            <span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">DefaultRolloverStrategy</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">Delete</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">basePath</span>&gt;</span>${sys:pulsar.function.log.dir}<span class="hljs-tag">&lt;/<span class="hljs-name">basePath</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">maxDepth</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">maxDepth</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">IfFileName</span>&gt;</span><br />                        <span class="hljs-tag">&lt;<span class="hljs-name">glob</span>&gt;</span>*/${sys:pulsar.function.log.file}.bk*log.gz<span class="hljs-tag">&lt;/<span class="hljs-name">glob</span>&gt;</span><br />                    <span class="hljs-tag">&lt;/<span class="hljs-name">IfFileName</span>&gt;</span><br />                    <span class="hljs-tag">&lt;<span class="hljs-name">IfLastModified</span>&gt;</span><br />                        <span class="hljs-tag">&lt;<span class="hljs-name">age</span>&gt;</span>30d<span class="hljs-tag">&lt;/<span class="hljs-name">age</span>&gt;</span><br />                    <span class="hljs-tag">&lt;/<span class="hljs-name">IfLastModified</span>&gt;</span><br />                <span class="hljs-tag">&lt;/<span class="hljs-name">Delete</span>&gt;</span><br />            <span class="hljs-tag">&lt;/<span class="hljs-name">DefaultRolloverStrategy</span>&gt;</span><br />        <span class="hljs-tag">&lt;/<span class="hljs-name">RollingRandomAccessFile</span>&gt;</span><br />    <span class="hljs-tag">&lt;/<span class="hljs-name">Appenders</span>&gt;</span><br />    <span class="hljs-tag">&lt;<span class="hljs-name">Loggers</span>&gt;</span><br />        <span class="hljs-tag">&lt;<span class="hljs-name">Logger</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>org.apache.pulsar.functions.runtime.shaded.org.apache.bookkeeper<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>${sys:bk.log.level}<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">additivity</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">additivity</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">ref</span>&gt;</span>BkRollingFile<span class="hljs-tag">&lt;/<span class="hljs-name">ref</span>&gt;</span><br />            <span class="hljs-tag">&lt;/<span class="hljs-name">AppenderRef</span>&gt;</span><br />        <span class="hljs-tag">&lt;/<span class="hljs-name">Logger</span>&gt;</span><br />        <span class="hljs-tag">&lt;<span class="hljs-name">Root</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>${sys:pulsar.log.level}<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">ref</span>&gt;</span>${sys:pulsar.log.appender}<span class="hljs-tag">&lt;/<span class="hljs-name">ref</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>${sys:pulsar.log.level}<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br />            <span class="hljs-tag">&lt;/<span class="hljs-name">AppenderRef</span>&gt;</span><br />        <span class="hljs-tag">&lt;/<span class="hljs-name">Root</span>&gt;</span><br />    <span class="hljs-tag">&lt;/<span class="hljs-name">Loggers</span>&gt;</span><br /><span class="hljs-tag">&lt;/<span class="hljs-name">Configuration</span>&gt;</span><br /></code></pre>
<p>The properties set like:</p>
<pre><code class="hljs css language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Property</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>pulsar.log.level<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>debug<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br />        <span class="hljs-tag">&lt;/<span class="hljs-name">Property</span>&gt;</span><br /></code></pre>
<p>propagate to places where they are referenced, such as:</p>
<pre><code class="hljs css language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Root</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>${sys:pulsar.log.level}<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">ref</span>&gt;</span>${sys:pulsar.log.appender}<span class="hljs-tag">&lt;/<span class="hljs-name">ref</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>${sys:pulsar.log.level}<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br />            <span class="hljs-tag">&lt;/<span class="hljs-name">AppenderRef</span>&gt;</span><br />        <span class="hljs-tag">&lt;/<span class="hljs-name">Root</span>&gt;</span><br /></code></pre>
<p>In the above example, debug level logging would be applied to ALL function logs. This may be more verbose than you desire. To be more selective, you can apply different log levels to different classes or modules. For example:</p>
<pre><code class="hljs css language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Logger</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>com.example.module<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>info<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">additivity</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">additivity</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">ref</span>&gt;</span>${sys:pulsar.log.appender}<span class="hljs-tag">&lt;/<span class="hljs-name">ref</span>&gt;</span><br />            <span class="hljs-tag">&lt;/<span class="hljs-name">AppenderRef</span>&gt;</span><br />        <span class="hljs-tag">&lt;/<span class="hljs-name">Logger</span>&gt;</span><br /></code></pre>
<p>You can be more specific as well, such as applying a more verbose log level to a class in the module, such as:</p>
<pre><code class="hljs css language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Logger</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>com.example.module.className<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>debug<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">additivity</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">additivity</span>&gt;</span><br />            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span>&gt;</span><br />                <span class="hljs-tag">&lt;<span class="hljs-name">ref</span>&gt;</span>Console<span class="hljs-tag">&lt;/<span class="hljs-name">ref</span>&gt;</span><br />            <span class="hljs-tag">&lt;/<span class="hljs-name">AppenderRef</span>&gt;</span><br />        <span class="hljs-tag">&lt;/<span class="hljs-name">Logger</span>&gt;</span><br /></code></pre>
<p>Each <code>&lt;AppenderRef&gt;</code> entry allows you to output the log to a target specified in the definition of the Appender.</p>
<p>Additivity pertains to whether log messages will be duplicated if multiple Logger entries overlap. To disable additivity, specify</p>
<pre><code class="hljs css language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">additivity</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">additivity</span>&gt;</span><br /></code></pre>
<p>as shown in examples above. Disabling additivity prevents duplication of log messages when one or more <code>&lt;Logger&gt;</code> entries contain classes or modules that overlap.</p>
<p>The <code>&lt;AppenderRef&gt;</code> is defined in the <code>&lt;Appenders&gt;</code> section, such as:</p>
<pre><code class="hljs css language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Console</span>&gt;</span><br />  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Console<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br />  <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>SYSTEM_OUT<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br />  <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span>&gt;</span><br />    <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>%d{ISO8601_OFFSET_DATE_TIME_HHMM} [%t] %-5level %logger{36} - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br />  <span class="hljs-tag">&lt;/<span class="hljs-name">PatternLayout</span>&gt;</span><br /><span class="hljs-tag">&lt;/<span class="hljs-name">Console</span>&gt;</span><br /></code></pre>
</span></div></div><div id="tab-group-3273-content-3275" class="tab-pane" data-group="group_3273" tabindex="-1"><div><span><p><code>WARNING</code>- or <code>INFO</code>-level log based on whether the incoming string contains the word <code>danger</code>.</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> pulsar <span class="hljs-keyword">import</span> Function<br /><br /><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoggingFunction</span><span class="hljs-params">(Function)</span>:</span><br />    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span><span class="hljs-params">(self, input, context)</span>:</span><br />        logger = context.get_logger()<br />        msg_id = context.get_message_id()<br />        <span class="hljs-keyword">if</span> <span class="hljs-string">'danger'</span> <span class="hljs-keyword">in</span> input:<br />            logger.warn(<span class="hljs-string">"A warning was received in message {0}"</span>.format(context.get_message_id()))<br />        <span class="hljs-keyword">else</span>:<br />            logger.info(<span class="hljs-string">"Message {0} received\nContent: {1}"</span>.format(msg_id, input))<br /></code></pre>
<p>If you want your function to produce logs on a Pulsar topic, you need to specify a <strong>log topic</strong> when creating or running the function. The following is an example.</p>
<pre><code class="hljs css language-bash">$ bin/pulsar-admin <span class="hljs-built_in">functions</span> create \<br />  --py logging_function.py \<br />  --classname logging_function.LoggingFunction \<br />  --<span class="hljs-built_in">log</span>-topic logging-function-logs \<br />  <span class="hljs-comment"># Other function configs</span><br /></code></pre>
<p>All logs produced by <code>LoggingFunction</code> above can be accessed via the <code>logging-function-logs</code> topic. Additionally, you can specify the function log level through the broker XML file as described in <a href="#customize-function-log-level">Customize Function log level</a>.</p>
</span></div></div><div id="tab-group-3273-content-3276" class="tab-pane" data-group="group_3273" tabindex="-1"><div><span><pre><code class="hljs">import (<br />    &quot;context&quot;<br /><br />    &quot;github.com/apache/pulsar/pulsar-function-go/pf&quot;<br /><br />    log &quot;github.com/apache/pulsar/pulsar-function-go/logutil&quot;<br />)<br /><br />func loggerFunc(ctx context.Context, input []byte) {<br />  if len(input) &lt;= 100 {<br />    log.Infof(&quot;This input has a length of: %d&quot;, len(input))<br />  } else {<br />    log.Warnf(&quot;This input is getting too long! It has {%d} characters&quot;, len(input))<br />  }<br />}<br /><br />func main() {<br />  pf.Start(loggerFunc)<br />}<br /></code></pre>
<p>When you use <code>logTopic</code> related functionalities in Go Function, import <code>github.com/apache/pulsar/pulsar-function-go/logutil</code>, and you do not have to use the <code>getLogger()</code> context object.</p>
<p>Additionally, you can specify the function log level through the broker XML file, as described here: <a href="#customize-function-log-level">Customize Function log level</a></p>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="pulsar-admin"></a><a href="#pulsar-admin" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pulsar admin</h3>
<p>Pulsar Functions using the Java SDK has access to the Pulsar admin client, which allows the Pulsar admin client to manage API calls to current Pulsar clusters or external clusters (if <code>external-pulsars</code> is provided).</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-3277-tab-3278" class="nav-link active" data-group="group_3277" data-tab="tab-group-3277-content-3278">Java</div></div><div class="tab-content"><div id="tab-group-3277-content-3278" class="tab-pane active" data-group="group_3277" tabindex="-1"><div><span><p>Below is an example of how to use the Pulsar admin client exposed from the Function <code>context</code>.</p>
<pre><code class="hljs">import org.apache.pulsar.client.admin.PulsarAdmin;<br />import org.apache.pulsar.functions.api.Context;<br />import org.apache.pulsar.functions.api.Function;<br /><br />/**<br /> * In this particular example, for every input message,<br /> * the function resets the cursor of the current function's subscription to a<br /> * specified timestamp.<br /> */<br />public class CursorManagementFunction implements Function&lt;String, String&gt; {<br /><br />    @Override<br />    public String process(String input, Context context) throws Exception {<br />        PulsarAdmin adminClient = context.getPulsarAdmin();<br />        if (adminClient != null) {<br />            String topic = context.getCurrentRecord().getTopicName().isPresent() ?<br />                    context.getCurrentRecord().getTopicName().get() : null;<br />            String subName = context.getTenant() + &quot;/&quot; + context.getNamespace() + &quot;/&quot; + context.getFunctionName();<br />            if (topic != null) {<br />                // 1578188166 below is a random-pick timestamp<br />                adminClient.topics().resetCursor(topic, subName, 1578188166);<br />                return &quot;reset cursor successfully&quot;;<br />            }<br />        }<br />        return null;<br />    }<br />}<br /></code></pre>
<p>If you want your function to get access to the Pulsar admin client, you need to enable this feature by setting <code>exposeAdminClientEnabled=true</code> in the <code>functions_worker.yml</code> file. You can test whether this feature is enabled or not using the command <code>pulsar-admin functions localrun</code> with the flag <code>--web-service-url</code>.</p>
<pre><code class="hljs">$ bin/pulsar-admin functions localrun \<br /> --jar my-functions.jar \<br /> --classname my.package.CursorManagementFunction \<br /> --web-service-url http://pulsar-web-service:8080 \<br /> # Other function configs<br /></code></pre>
</span></div></div></div></div>
<h2><a class="anchor" aria-hidden="true" id="量測指標"></a><a href="#量測指標" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>量測指標</h2>
<p>Pulsar Functions allows you to deploy and manage processing functions that consume messages from and publish messages to Pulsar topics easily. It is important to ensure that the running functions are healthy at any time. Pulsar Functions can publish arbitrary metrics to the metrics interface which can be queried.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>如果 Pulsar Function 使用 Java 或 Python 的 language-native 介面接口，則該 function 無法將度量和統計信息發佈到 Pulsar。</p>
</blockquote>
<p>You can monitor Pulsar Functions that have been deployed with the following methods:</p>
<ul>
<li><p>Check the metrics provided by Pulsar.</p>
<p>Pulsar Functions expose the metrics that can be collected and used for monitoring the health of <strong>Java, Python, and Go</strong> functions. You can check the metrics by following the <a href="/docs/zh-TW/next/deploy-monitoring">monitoring</a> guide.</p>
<p>For the complete list of the function metrics, see <a href="/docs/zh-TW/next/reference-metrics#pulsar-functions">here</a>.</p></li>
<li><p>Set and check your customized metrics.</p>
<p>In addition to the metrics provided by Pulsar, Pulsar allows you to customize metrics for <strong>Java and Python</strong> functions. Function workers collect user-defined metrics to Prometheus automatically and you can check them in Grafana.</p></li>
</ul>
<p>Here are examples of how to customize metrics for Java and Python functions.</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-3279-tab-3280" class="nav-link active" data-group="group_3279" data-tab="tab-group-3279-content-3280">Java</div><div id="tab-group-3279-tab-3281" class="nav-link" data-group="group_3279" data-tab="tab-group-3279-content-3281">Python</div><div id="tab-group-3279-tab-3282" class="nav-link" data-group="group_3279" data-tab="tab-group-3279-content-3282">Go</div></div><div class="tab-content"><div id="tab-group-3279-content-3280" class="tab-pane active" data-group="group_3279" tabindex="-1"><div><span><p><a href="#context"><code>Context</code></a> object on a per-key basis. For example, you can set a metric for the <code>process-count</code> key and a different metric for the <code>elevens-count</code> key every time the function processes a message.</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Context;<br /><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Function;<br /><br /><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MetricRecorderFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">Integer</span>, <span class="hljs-title">Void</span>&gt; </span>{<br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">apply</span><span class="hljs-params">(Integer input, Context context)</span> </span>{<br />        <span class="hljs-comment">// Records the metric 1 every time a message arrives</span><br />        context.recordMetric(<span class="hljs-string">"hit-count"</span>, <span class="hljs-number">1</span>);<br /><br />        <span class="hljs-comment">// Records the metric only if the arriving number equals 11</span><br />        <span class="hljs-keyword">if</span> (input == <span class="hljs-number">11</span>) {<br />            context.recordMetric(<span class="hljs-string">"elevens-count"</span>, <span class="hljs-number">1</span>);<br />        }<br /><br />        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br />    }<br />}<br /></code></pre>
</span></div></div><div id="tab-group-3279-content-3281" class="tab-pane" data-group="group_3279" tabindex="-1"><div><span><p><a href="#context"><code>Context</code></a> object on a per-key basis. For example, you can set a metric for the <code>process-count</code> key and a different metric for the <code>elevens-count</code> key every time the function processes a message. The following is an example.</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> pulsar <span class="hljs-keyword">import</span> Function<br /><br /><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MetricRecorderFunction</span><span class="hljs-params">(Function)</span>:</span><br />    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span><span class="hljs-params">(self, input, context)</span>:</span><br />        context.record_metric(<span class="hljs-string">'hit-count'</span>, <span class="hljs-number">1</span>)<br /><br />        <span class="hljs-keyword">if</span> input == <span class="hljs-number">11</span>:<br />            context.record_metric(<span class="hljs-string">'elevens-count'</span>, <span class="hljs-number">1</span>)<br /></code></pre>
</span></div></div><div id="tab-group-3279-content-3282" class="tab-pane" data-group="group_3279" tabindex="-1"><div><span><p><a href="#context"><code>Context</code></a> object enables you to record metrics on a per-key basis. For example, you can set a metric for the <code>process-count</code> key and a different metric for the <code>elevens-count</code> key every time the function processes a message:</p>
<pre><code class="hljs css language-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">metricRecorderFunction</span><span class="hljs-params">(ctx context.Context, in []<span class="hljs-keyword">byte</span>)</span> <span class="hljs-title">error</span></span> {<br />  inputstr := <span class="hljs-keyword">string</span>(in)<br />  fctx, ok := pf.FromContext(ctx)<br />  <span class="hljs-keyword">if</span> !ok {<br />    <span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">"get Go Functions Context error"</span>)<br />  }<br />  fctx.RecordMetric(<span class="hljs-string">"hit-count"</span>, <span class="hljs-number">1</span>)<br />  <span class="hljs-keyword">if</span> inputstr == <span class="hljs-string">"eleven"</span> {<br />    fctx.RecordMetric(<span class="hljs-string">"elevens-count"</span>, <span class="hljs-number">1</span>)<br />  }<br />  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br />}<br /></code></pre>
</span></div></div></div></div>
<h2><a class="anchor" aria-hidden="true" id="安全"></a><a href="#安全" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安全</h2>
<p>如果要在 Pulsar Functions 上啟用安全性，首先應在 <a href="/docs/zh-TW/next/functions-worker">Functions Workers</a> 上啟用安全性功能。 相關更多詳細訊息，請參閱 <a href="/docs/zh-TW/next/functions-worker#security-settings">Security settings</a>。</p>
<p>Pulsar Functions 可以支持以下的 providers:</p>
<ul>
<li>ClearTextSecretsProvider</li>
<li>EnvironmentBasedSecretsProvider</li>
</ul>
<blockquote>
<p>Pulsar Function 預設情況下支持 ClearTextSecretsProvider。</p>
</blockquote>
<p>At the same time, Pulsar Functions provides two interfaces, <strong>SecretsProvider</strong> and <strong>SecretsProviderConfigurator</strong>, allowing users to customize secret provider.</p>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-3283-tab-3284" class="nav-link active" data-group="group_3283" data-tab="tab-group-3283-content-3284">Java</div><div id="tab-group-3283-tab-3285" class="nav-link" data-group="group_3283" data-tab="tab-group-3283-content-3285">Python</div><div id="tab-group-3283-tab-3286" class="nav-link" data-group="group_3283" data-tab="tab-group-3283-content-3286">Go</div></div><div class="tab-content"><div id="tab-group-3283-content-3284" class="tab-pane active" data-group="group_3283" tabindex="-1"><div><span><p><a href="#context"><code>Context</code></a> 物件來取得 secret provider。 The following is an example:</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Context;<br /><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Function;<br /><span class="hljs-keyword">import</span> org.slf4j.Logger;<br /><br /><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetSecretProviderFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Void</span>&gt; </span>{<br /><br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> Void <span class="hljs-title">process</span><span class="hljs-params">(String input, Context context)</span> <span class="hljs-keyword">throws</span> Exception </span>{<br />        Logger LOG = context.getLogger();<br />        String secretProvider = context.getSecret(input);<br /><br />        <span class="hljs-keyword">if</span> (!secretProvider.isEmpty()) {<br />            LOG.info(<span class="hljs-string">"The secret provider is {}"</span>, secretProvider);<br />        } <span class="hljs-keyword">else</span> {<br />            LOG.warn(<span class="hljs-string">"No secret provider"</span>);<br />        }<br /><br />        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br />    }<br />}<br /></code></pre>
</span></div></div><div id="tab-group-3283-content-3285" class="tab-pane" data-group="group_3283" tabindex="-1"><div><span><p><a href="#context"><code>Context</code></a> 物件來取得 secret provider。 The following is an example:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> pulsar <span class="hljs-keyword">import</span> Function<br /><br /><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetSecretProviderFunction</span><span class="hljs-params">(Function)</span>:</span><br />    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span><span class="hljs-params">(self, input, context)</span>:</span><br />        logger = context.get_logger()<br />        secret_provider = context.get_secret(input)<br />        <span class="hljs-keyword">if</span> secret_provider <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br />            logger.warn(<span class="hljs-string">'No secret provider'</span>)<br />        <span class="hljs-keyword">else</span>:<br />            logger.info(<span class="hljs-string">"The secret provider is {0}"</span>.format(secret_provider))<br /><br /></code></pre>
</span></div></div><div id="tab-group-3283-content-3286" class="tab-pane" data-group="group_3283" tabindex="-1"><div><span></span></div></div></div></div>
<h2><a class="anchor" aria-hidden="true" id="狀態存儲"></a><a href="#狀態存儲" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>狀態存儲</h2>
<p>Pulsar Functions use <a href="https://bookkeeper.apache.org">Apache BookKeeper</a> as a state storage interface. Pulsar installation, including the local standalone installation, includes deployment of BookKeeper bookies.</p>
<p>Since Pulsar 2.1.0 release, Pulsar integrates with Apache BookKeeper <a href="https://docs.google.com/document/d/155xAwWv5IdOitHh1NVMEwCMGgB28M3FyMiQSxEpjE-Y/edit#heading=h.56rbh52koe3f">table service</a> to store the <code>State</code> for functions. For example, a <code>WordCount</code> function can store its <code>counters</code> state into BookKeeper table service via Pulsar Functions State API.</p>
<p>States are key-value pairs, where the key is a string and the value is arbitrary binary data - counters are stored as 64-bit big-endian binary values. Keys are scoped to an individual Pulsar Function, and shared between instances of that function.</p>
<p>You can access states within Pulsar Java Functions using the <code>putState</code>, <code>putStateAsync</code>, <code>getState</code>, <code>getStateAsync</code>, <code>incrCounter</code>, <code>incrCounterAsync</code>, <code>getCounter</code>, <code>getCounterAsync</code> and <code>deleteState</code> calls on the context object. You can access states within Pulsar Python Functions using the <code>putState</code>, <code>getState</code>, <code>incrCounter</code>, <code>getCounter</code> and <code>deleteState</code> calls on the context object. You can also manage states using the <a href="#query-state">querystate</a> and <a href="#putstate">putstate</a> options to <code>pulsar-admin functions</code>.</p>
<blockquote>
<p>Note<br>
State storage is not available in Go.</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="api"></a><a href="#api" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API</h3>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-3287-tab-3288" class="nav-link active" data-group="group_3287" data-tab="tab-group-3287-content-3288">Java</div><div id="tab-group-3287-tab-3289" class="nav-link" data-group="group_3287" data-tab="tab-group-3287-content-3289">Python</div></div><div class="tab-content"><div id="tab-group-3287-content-3288" class="tab-pane active" data-group="group_3287" tabindex="-1"><div><span><p><a href="/docs/zh-TW/next/functions-develop#context">Context</a> object when you are using Java SDK functions.</p>
<h4><a class="anchor" aria-hidden="true" id="incrcounter"></a><a href="#incrcounter" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>incrCounter</h4>
<pre><code class="hljs css language-java">    <span class="hljs-comment">/**<br />     * Increment the builtin distributed counter referred by key<br />     * <span class="hljs-doctag">@param</span> key The name of the key<br />     * <span class="hljs-doctag">@param</span> amount The amount to be incremented<br />     */</span><br />    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">incrCounter</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> amount)</span></span>;<br /></code></pre>
<p>The application can use <code>incrCounter</code> to change the counter of a given <code>key</code> by the given <code>amount</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="incrcounterasync"></a><a href="#incrcounterasync" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>incrCounterAsync</h4>
<pre><code class="hljs css language-java">     <span class="hljs-comment">/**<br />     * Increment the builtin distributed counter referred by key<br />     * but dont wait for the completion of the increment operation<br />     *<br />     * <span class="hljs-doctag">@param</span> key The name of the key<br />     * <span class="hljs-doctag">@param</span> amount The amount to be incremented<br />     */</span><br />    <span class="hljs-function">CompletableFuture&lt;Void&gt; <span class="hljs-title">incrCounterAsync</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> amount)</span></span>;<br /></code></pre>
<p>The application can use <code>incrCounterAsync</code> to asynchronously change the counter of a given <code>key</code> by the given <code>amount</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="getcounter"></a><a href="#getcounter" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>getCounter</h4>
<pre><code class="hljs css language-java">    <span class="hljs-comment">/**<br />     * Retrieve the counter value for the key.<br />     *<br />     * <span class="hljs-doctag">@param</span> key name of the key<br />     * <span class="hljs-doctag">@return</span> the amount of the counter value for this key<br />     */</span><br />    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">getCounter</span><span class="hljs-params">(String key)</span></span>;<br /></code></pre>
<p>The application can use <code>getCounter</code> to retrieve the counter of a given <code>key</code> mutated by <code>incrCounter</code>.</p>
<p>Except the <code>counter</code> API, Pulsar also exposes a general key/value API for functions to store general key/value state.</p>
<h4><a class="anchor" aria-hidden="true" id="getcounterasync"></a><a href="#getcounterasync" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>getCounterAsync</h4>
<pre><code class="hljs css language-java">     <span class="hljs-comment">/**<br />     * Retrieve the counter value for the key, but don't wait<br />     * for the operation to be completed<br />     *<br />     * <span class="hljs-doctag">@param</span> key name of the key<br />     * <span class="hljs-doctag">@return</span> the amount of the counter value for this key<br />     */</span><br />    <span class="hljs-function">CompletableFuture&lt;Long&gt; <span class="hljs-title">getCounterAsync</span><span class="hljs-params">(String key)</span></span>;<br /></code></pre>
<p>The application can use <code>getCounterAsync</code> to asynchronously retrieve the counter of a given <code>key</code> mutated by <code>incrCounterAsync</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="putstate"></a><a href="#putstate" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>putState</h4>
<pre><code class="hljs css language-java">    <span class="hljs-comment">/**<br />     * Update the state value for the key.<br />     *<br />     * <span class="hljs-doctag">@param</span> key name of the key<br />     * <span class="hljs-doctag">@param</span> value state value of the key<br />     */</span><br />    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">putState</span><span class="hljs-params">(String key, ByteBuffer value)</span></span>;<br /></code></pre>
<h4><a class="anchor" aria-hidden="true" id="putstateasync"></a><a href="#putstateasync" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>putStateAsync</h4>
<pre><code class="hljs css language-java">    <span class="hljs-comment">/**<br />     * Update the state value for the key, but don't wait for the operation to be completed<br />     *<br />     * <span class="hljs-doctag">@param</span> key name of the key<br />     * <span class="hljs-doctag">@param</span> value state value of the key<br />     */</span><br />    <span class="hljs-function">CompletableFuture&lt;Void&gt; <span class="hljs-title">putStateAsync</span><span class="hljs-params">(String key, ByteBuffer value)</span></span>;<br /></code></pre>
<p>The application can use <code>putStateAsync</code> to asynchronously update the state of a given <code>key</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="getstate"></a><a href="#getstate" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>getState</h4>
<pre><code class="hljs css language-java">    <span class="hljs-comment">/**<br />     * Retrieve the state value for the key.<br />     *<br />     * <span class="hljs-doctag">@param</span> key name of the key<br />     * <span class="hljs-doctag">@return</span> the state value for the key.<br />     */</span><br />    <span class="hljs-function">ByteBuffer <span class="hljs-title">getState</span><span class="hljs-params">(String key)</span></span>;<br /></code></pre>
<h4><a class="anchor" aria-hidden="true" id="getstateasync"></a><a href="#getstateasync" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>getStateAsync</h4>
<pre><code class="hljs css language-java">    <span class="hljs-comment">/**<br />     * Retrieve the state value for the key, but don't wait for the operation to be completed<br />     *<br />     * <span class="hljs-doctag">@param</span> key name of the key<br />     * <span class="hljs-doctag">@return</span> the state value for the key.<br />     */</span><br />    <span class="hljs-function">CompletableFuture&lt;ByteBuffer&gt; <span class="hljs-title">getStateAsync</span><span class="hljs-params">(String key)</span></span>;<br /></code></pre>
<p>The application can use <code>getStateAsync</code> to asynchronously retrieve the state of a given <code>key</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="deletestate"></a><a href="#deletestate" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>deleteState</h4>
<pre><code class="hljs css language-java">    <span class="hljs-comment">/**<br />     * Delete the state value for the key.<br />     *<br />     * <span class="hljs-doctag">@param</span> key   name of the key<br />     */</span><br /></code></pre>
<p>Counters and binary values share the same keyspace, so this deletes either type.</p>
</span></div></div><div id="tab-group-3287-content-3289" class="tab-pane" data-group="group_3287" tabindex="-1"><div><span><p><a href="#context">Context</a> object when you are using Python SDK functions.</p>
<h4><a class="anchor" aria-hidden="true" id="incr_counter"></a><a href="#incr_counter" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>incr_counter</h4>
<pre><code class="hljs css language-python">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">incr_counter</span><span class="hljs-params">(self, key, amount)</span>:</span><br />    <span class="hljs-string">"""incr the counter of a given key in the managed state"""</span><br /></code></pre>
<p>Application can use <code>incr_counter</code> to change the counter of a given <code>key</code> by the given <code>amount</code>. If the <code>key</code> does not exist, a new key is created.</p>
<h4><a class="anchor" aria-hidden="true" id="get_counter"></a><a href="#get_counter" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>get_counter</h4>
<pre><code class="hljs css language-python">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_counter</span><span class="hljs-params">(self, key)</span>:</span><br />    <span class="hljs-string">"""get the counter of a given key in the managed state"""</span><br /></code></pre>
<p>Application can use <code>get_counter</code> to retrieve the counter of a given <code>key</code> mutated by <code>incrCounter</code>.</p>
<p>Except the <code>counter</code> API, Pulsar also exposes a general key/value API for functions to store general key/value state.</p>
<h4><a class="anchor" aria-hidden="true" id="put_state"></a><a href="#put_state" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>put_state</h4>
<pre><code class="hljs css language-python">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">put_state</span><span class="hljs-params">(self, key, value)</span>:</span><br />    <span class="hljs-string">"""update the value of a given key in the managed state"""</span><br /></code></pre>
<p>The key is a string, and the value is arbitrary binary data.</p>
<h4><a class="anchor" aria-hidden="true" id="get_state"></a><a href="#get_state" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>get_state</h4>
<pre><code class="hljs css language-python">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_state</span><span class="hljs-params">(self, key)</span>:</span><br />    <span class="hljs-string">"""get the value of a given key in the managed state"""</span><br /></code></pre>
<h4><a class="anchor" aria-hidden="true" id="del_counter"></a><a href="#del_counter" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>del_counter</h4>
<pre><code class="hljs css language-python">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">del_counter</span><span class="hljs-params">(self, key)</span>:</span><br />    <span class="hljs-string">"""delete the counter of a given key in the managed state"""</span><br /></code></pre>
<p>Counters and binary values share the same keyspace, so this deletes either type.</p>
</span></div></div></div></div>
<h3><a class="anchor" aria-hidden="true" id="query-state"></a><a href="#query-state" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Query State</h3>
<p>A Pulsar Function can use the <a href="#api">State API</a> for storing state into Pulsar's state storage and retrieving state back from Pulsar's state storage. Additionally Pulsar also provides CLI commands for querying its state.</p>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> bin/pulsar-admin <span class="hljs-built_in">functions</span> querystate \</span>
    --tenant &lt;tenant&gt; \
    --namespace &lt;namespace&gt; \
    --name &lt;function-name&gt; \
    --state-storage-url &lt;bookkeeper-service-url&gt; \
    --key &lt;state-key&gt; \
    [---watch]
</code></pre>
<p>If <code>--watch</code> is specified, the CLI will watch the value of the provided <code>state-key</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="example-1"></a><a href="#example-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h3>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-3290-tab-3291" class="nav-link active" data-group="group_3290" data-tab="tab-group-3290-content-3291">Java</div><div id="tab-group-3290-tab-3292" class="nav-link" data-group="group_3290" data-tab="tab-group-3290-content-3292">Python</div></div><div class="tab-content"><div id="tab-group-3290-content-3291" class="tab-pane active" data-group="group_3290" tabindex="-1"><div><span><p><a href="https://github.com/apache/pulsar/tree/master//pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/WordCountFunction.java"><code>WordCountFunction</code></a>
 is a very good example demonstrating on how Application can easily store <code>state</code> in Pulsar Functions.</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Context;<br /><span class="hljs-keyword">import</span> org.apache.pulsar.functions.api.Function;<br /><br /><span class="hljs-keyword">import</span> java.util.Arrays;<br /><br /><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WordCountFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Void</span>&gt; </span>{<br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> Void <span class="hljs-title">process</span><span class="hljs-params">(String input, Context context)</span> <span class="hljs-keyword">throws</span> Exception </span>{<br />        Arrays.asList(input.split(<span class="hljs-string">"\\."</span>)).forEach(word -&gt; context.incrCounter(word, <span class="hljs-number">1</span>));<br />        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br />    }<br />}<br /></code></pre>
<p>The logic of this <code>WordCount</code> function is pretty simple and straightforward:</p>
<ol>
<li>該 function 首先使用正規表達式 <code>\\.</code> 來將接收到的 <code>String</code> 拆分為多個 <code>word</code>。</li>
<li>對於每個 <code>word</code>，該 function 將相應的 <code>counter</code> 透過呼叫 <code>incrCounter(key，amount)</code> 來遞增 1。</li>
</ol>
</span></div></div><div id="tab-group-3290-content-3292" class="tab-pane" data-group="group_3290" tabindex="-1"><div><span><pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> pulsar <span class="hljs-keyword">import</span> Function<br /><br /><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WordCount</span><span class="hljs-params">(Function)</span>:</span><br />    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span><span class="hljs-params">(self, item, context)</span>:</span><br />        <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> item.split():<br />            context.incr_counter(word, <span class="hljs-number">1</span>)<br /></code></pre>
<p>The logic of this <code>WordCount</code> function is pretty simple and straightforward:</p>
<ol>
<li>該 function 將接收到的 String 拆分為多個 <code>word</code>。</li>
<li>對於每個 <code>word</code>，該 function 將相應的 <code>counter</code> 透過呼叫 <code>incr_counter(key，amount)</code> 來遞增 1。</li>
</ol>
</span></div></div></div></div></span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/zh-TW/next/functions-worker"><span class="arrow-prev">← </span><span>Setup: Pulsar Functions Worker</span></a><a class="docs-next button" href="/docs/zh-TW/next/functions-package"><span>How-to: Package</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#目前支持的-api">目前支持的 API</a><ul class="toc-headings"><li><a href="#language-native-interface">Language-native interface</a></li><li><a href="#javapythongo-的-pulsar-function-sdk">Java/Python/Go 的 Pulsar Function SDK</a></li><li><a href="#extended-pulsar-function-sdk-for-java">Extended Pulsar Function SDK for Java</a></li></ul></li><li><a href="#schema-註冊管理">Schema 註冊管理</a></li><li><a href="#serde">SerDe</a><ul class="toc-headings"><li><a href="#example">Example</a></li></ul></li><li><a href="#context">Context</a><ul class="toc-headings"><li><a href="#user-config">User config</a></li><li><a href="#logger">Logger</a></li><li><a href="#pulsar-admin">Pulsar admin</a></li></ul></li><li><a href="#量測指標">量測指標</a></li><li><a href="#安全">安全</a></li><li><a href="#狀態存儲">狀態存儲</a><ul class="toc-headings"><li><a href="#api">API</a></li><li><a href="#query-state">Query State</a></li><li><a href="#example-1">Example</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2022 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</section><span><script>
      const community = document.querySelector("a[href='#community']").parentNode;
      const communityMenu =
        '<li>' +
        '<a id="community-menu" href="#">Community <span style="font-size: 0.75em">&nbsp;▼</span></a>' +
        '<div id="community-dropdown" class="hide">' +
          '<ul id="community-dropdown-items">' +
            '<li><a href="/zh-TW/contact">Contact</a></li>' +
            '<li><a href="/zh-TW/contributing">Contributing</a></li>' +
            '<li><a href="/zh-TW/coding-guide">Coding guide</a></li>' +
            '<li><a href="/zh-TW/events">Events</a></li>' +
            '<li><a href="https://twitter.com/Apache_Pulsar" target="_blank">Twitter &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/wiki" target="_blank">Wiki &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/issues" target="_blank">Issue tracking &#x2750</a></li>' +
            '<li><a href="https://pulsar-summit.org/" target="_blank">Pulsar Summit &#x2750</a></li>' +
            '<li>&nbsp;</li>' +
            '<li><a href="/zh-TW/resources">Resources</a></li>' +
            '<li><a href="/zh-TW/team">Team</a></li>' +
            '<li><a href="/zh-TW/powered-by">Powered By</a></li>' +
          '</ul>' +
        '</div>' +
        '</li>';

      community.innerHTML = communityMenu;

      const communityMenuItem = document.getElementById("community-menu");
      const communityDropDown = document.getElementById("community-dropdown");
      communityMenuItem.addEventListener("click", function(event) {
        event.preventDefault();

        if (communityDropDown.className == 'hide') {
          communityDropDown.className = 'visible';
        } else {
          communityDropDown.className = 'hide';
        }
      });
    </script></span></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'd226a455cecdd4bc18a554c1b47e5b52',
                indexName: 'apache_pulsar',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-TW","version:next"]}
              });
            </script></body></html>